<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.83.0" /><link rel="canonical" type="text/html" href="../../../../docs/administration/advanced/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="../../../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../../../favicons/android-192x192.png" sizes="192x192">

<title>Advanced | CVAT</title>
<meta name="description" content=""><meta property="og:title" content="Advanced" />
<meta property="og:description" content="This section contains advanced documents for system administrators." />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/administration/advanced/" /><meta property="og:site_name" content="CVAT" />

<meta itemprop="name" content="Advanced">
<meta itemprop="description" content="This section contains advanced documents for system administrators."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Advanced"/>
<meta name="twitter:description" content="This section contains advanced documents for system administrators."/>




<link rel="preload" href="../../../../scss/main.min.6c5c9450c6df778171581cbf2aa82ce445787ffee7a644313041b00ff75d710d.css" as="style">
<link href="../../../../scss/main.min.6c5c9450c6df778171581cbf2aa82ce445787ffee7a644313041b00ff75d710d.css" rel="stylesheet" integrity="">


<script
  src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>



<link rel="stylesheet" href="../../../../css/prism.css"/>






  </head>
  <body class="td-section">
    <header>
      


<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="../../../../about/">
    <span class="navbar-logo"><svg width="80" height="15" viewBox="0 0 80 15" xmlns="http://www.w3.org/2000/svg"><path d="M6.63399 15C2.37083 15 0 12.5333.0 7.48889.0 2.46667 2.34908.0 6.63399.0H10.6576V2.62222H6.63399c-2.84935.0-4.0674 1.44445-4.0674 4.86667.0 3.44441 1.2398 4.88891 4.0674 4.88891H15.0638V15H6.63399z"/><path d="M22.412.0l4.8346 13.1004C27.7814 14.5415 28.8724 15 30.2842 15 31.7817 15 32.7657 14.476 33.3005 13.1004L38.3918.0H35.5895L30.9902 11.8559C30.8404 12.2052 30.6265 12.3581 30.2842 12.3581 29.942 12.3581 29.7067 12.2052 29.5783 11.8559L25.1929.0H22.412z"/><path d="M53.0989 3.1441C53.2487 2.79476 53.484 2.64192 53.8262 2.64192 54.1685 2.64192 54.4038 2.79476 54.5322 3.1441L58.9176 15h2.8023L56.8425 1.89956C56.3291.524017 55.3451.0 53.8476.0 52.3288.0 51.3448.524017 50.81 1.89956L45.74 15h2.781L53.0989 3.1441z"/><path d="M69.0681.0V2.5665H73.2661V15H75.802V2.5665H80V0H69.0681z"/></svg></span>
  </a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        
        
        
        
        
        
        
        
        <a class="nav-link active" href="../../../../docs/" ><span class="active">Documentation</span></a>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        
        
        
        
        
        
        
        
        <a class="nav-link" href="../../../../about/" ><span>About</span></a>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        
        
        
        
        
        
        <a class="nav-link" href="https://app.cvat.ai"  ><span>Try it now</span></a>
      </li>
      
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        
        
        
        
        
        
        <a class="nav-link" href="https://github.com/opencv/cvat"  ><i class='fab fa-github'></i><span>GitHub</span></a>
      </li>
      
      
        
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-target="#dropdown_ver" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            v2.8.2
          </a>
        </li>
        
      
      
    </ul>
  </div>
  <div class="dropdown-menu" id="dropdown_ver" aria-labelledby="navbarDropdownMenuLink">
    
      
        <a class="dropdown-item" href="../../../../../docs/administration/advanced/">Latest version</a>
    
      
        <a class="dropdown-item" href="../../../../../v1.5.0/docs/administration/advanced/">v1.5.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v1.6.0/docs/administration/advanced/">v1.6.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v1.7.0/docs/administration/advanced/">v1.7.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.0.0/docs/administration/advanced/">v2.0.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.1.0/docs/administration/advanced/">v2.1.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.10.3/docs/administration/advanced/">v2.10.3</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.11.2/docs/administration/advanced/">v2.11.2</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.2.0/docs/administration/advanced/">v2.2.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.3.0/docs/administration/advanced/">v2.3.0</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.4.9/docs/administration/advanced/">v2.4.9</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.5.2/docs/administration/advanced/">v2.5.2</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.6.2/docs/administration/advanced/">v2.6.2</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.7.6/docs/administration/advanced/">v2.7.6</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.8.2/docs/administration/advanced/">v2.8.2</a>
    
      
        <a class="dropdown-item" href="../../../../../v2.9.2/docs/administration/advanced/">v2.9.2</a>
    
  </div>
  <div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../../../offline-search-index.a288b46ed9f996b999f02c8fc6b323d2.json"
  data-offline-search-base-href="../../../../"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="../../../../docs/administration/advanced/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Advanced</h1>
<div class="lead">This section contains advanced documents for system administrators.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-f616e778a276d7d8fcc8b4979e66a71e">CVAT deployment on Kubernetes with Helm</a></li>


    
  
    
    
	
<li>2: <a href="#pg-0525160925e6dcda34a919060abed2a7">Semi-automatic and Automatic Annotation</a></li>


    
  
    
    
	
<li>3: <a href="#pg-510d3a6059194f92357d8aa6f6ce7693">CVAT Analytics and monitoring</a></li>


    
  
    
    
	
<li>4: <a href="#pg-7545f3c848c8d646b0c6d2ceef722983">Mounting cloud storage</a></li>


    
  
    
    
	
<li>5: <a href="#pg-bc00cbca4716757ea2a98e7e6cd0e24c">LDAP Backed Authentication</a></li>


    
  
    
    
	
<li>6: <a href="#pg-c7cf871a1ff98f3a84b27456c266df2c">Backup guide</a></li>


    
  
    
    
	
<li>7: <a href="#pg-da6bd132cb59bd11a7d23d7656ddb37f">Upgrade guide</a></li>


    
  
    
    
	
<li>8: <a href="#pg-4f8e6a0deaea3f18579f18b2ee20ccd0">IAM: system roles</a></li>


    
  
    
    
	
<li>9: <a href="#pg-8c9745042bfb600d029dd86b05b8630e">Webhooks</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-f616e778a276d7d8fcc8b4979e66a71e">1 - CVAT deployment on Kubernetes with Helm</h1>
    <div class="lead">Instructions for deploying CVAT on a Kubernetes cluster.</div>
	<!--lint disable heading-style-->
<ul>
<li><a href="#prerequisites">Prerequisites</a>
<ul>
<li><a href="#installing-dependencies">Installing dependencies</a></li>
<li><a href="#optional-steps">Optional steps</a></li>
</ul>
</li>
<li><a href="#configuration">Configuration</a>
<ul>
<li><a href="#postgresql-password">Postgresql password?</a></li>
<li><a href="#optional-enable-auto-annotation-feature">(Optional) Enable Auto annotation feature</a></li>
<li><a href="#analytics">Analytics</a></li>
</ul>
</li>
<li><a href="#deployment">Deployment</a>
<ul>
<li><a href="#with-overrides">With overrides:</a></li>
<li><a href="#without-overrides">Without overrides:</a></li>
</ul>
</li>
<li><a href="#post-deployment-configuration">Post-deployment configuration</a>
<ul>
<li><a href="#how-to-create-superuser">How to create superuser?</a></li>
</ul>
</li>
<li><a href="#faq">FAQ</a>
<ul>
<li><a href="#what-is-kubernetes-and-how-it-is-working">What is kubernetes and how it is working?</a></li>
<li><a href="#what-is-helm-and-how-it-is-working">What is helm and how it is working?</a></li>
<li><a href="#how-to-setup-minikube">How to setup Minikube</a></li>
<li><a href="#how-to-understand-what-diff-will-be-inflicted-by-helm-upgrade">How to understand what diff will be inflicted by &lsquo;helm upgrade&rsquo;?</a></li>
<li><a href="#i-want-to-use-my-own-postgresqlredis-with-your-chart">I want to use my own postgresql/redis with your chart.</a></li>
<li><a href="#i-want-to-override-some-settings-in-valuesyaml">I want to override some settings in values.yaml.</a></li>
<li><a href="#why-you-used-external-charts-to-provide-redis-and-postgres">Why you used external charts to provide redis and postgres?</a></li>
</ul>
</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Installed and configured <a href="https://kubernetes.io/">kubernetes</a> cluster. If you do not already have a cluster,
you can create one by using <a href="https://github.com/kubernetes/minikube/">Minikube</a>. <a href="#how-to-setup-minikube">How to setup Minikube</a>.</li>
<li>Installed <a href="https://kubernetes.io/docs/tasks/tools/#kubectl">kubectl</a></li>
<li>Installed <a href="https://helm.sh/">Helm</a>.</li>
<li>Installed <a href="#installing-dependencies">dependencies</a></li>
</ol>
<h3 id="installing-dependencies">Installing dependencies</h3>
<p>To install and/or update run:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">helm dependency update
</code></pre></div><h3 id="optional-steps">Optional steps</h3>
<ol>
<li>
<p>Ingress configuration for the Traefik ingress controller is enabled by default.</p>
<p>Note for Minikube use:</p>
<ul>
<li>because the Traefik creates its main service with <code>Loadbalanser</code> type,
which involve the assignment of externalIP by Cloud, what never happens on Minikube,
you need to explicitly set the externalIP address for the traefic service.
Add the following to <code>values.override.yaml</code> file:
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">traefik</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">service</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">externalIPs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">&#34;your minikube IP (can be obtained with `minikube ip` command)&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
<li>Also ensure that your CVAT ingress appears on your hosts file (/etc/hosts).
You can do this by running this command:
<code>cvat.local</code> is default domainname, you can override it via <code>values.override.yaml</code>.
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>minikube ip<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06"> cvat.local&#34;</span> <span style="color:#000;font-weight:bold">|</span> sudo tee -a /etc/hosts
</code></pre></div></li>
</ul>
</li>
</ol>
<h2 id="configuration">Configuration</h2>
<ol>
<li>Create <code>values.override.yaml</code> file inside <code>helm-chart</code> directory.</li>
<li>Fill <code>values.override.yaml</code> with new parameters for chart.</li>
<li>Override <a href="#postgresql-password">postgresql password</a></li>
</ol>
<h3 id="postgresql-password">Postgresql password?</h3>
<p>Put below into your <code>values.override.yaml</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">postgresql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;insert_password&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">postgres_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;insert_postgres_password&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">replication_password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;insert_replication_password&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Or create your own secret and use it with:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">postgresql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">   </span><span style="color:#204a87;font-weight:bold">global</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">     </span><span style="color:#204a87;font-weight:bold">postgresql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">       </span><span style="color:#204a87;font-weight:bold">existingSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;secret&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="optional-enable-auto-annotation-feature">(Optional) Enable Auto annotation feature</h3>
<p>Before starting, ensure that the following prerequisites are met:</p>
<ul>
<li>The Nuclio <a href="https://nuclio.io/docs/latest/reference/nuctl/nuctl/">CLI (nuctl)</a> is installed.
To install the CLI, simply <a href="https://github.com/nuclio/nuclio/releases">download</a>
the appropriate CLI version to your installation machine.</li>
</ul>
<ol>
<li>
<p>Set <code>nuclio.enabled: true</code> in your <code>values.override.yaml</code></p>
</li>
<li>
<p>Run <code>helm dependency update</code> in <code>helm-chart</code> directory</p>
</li>
<li>
<p>Because Nuclio functions are images that need to be pushed and pulled to/from the registry,
you need to configure credentials to pull from your preferable registry with the following settings:
Options:</p>
<ul>
<li>
<p><code>values.override.yaml</code> file:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">registry</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">loginUrl</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">someurl</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">credentials</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">someuser</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">somepass</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
<li>
<p>Or you can create a secret with credentials as described in the <a href="https://nuclio.io/docs/latest/setup/k8s/running-in-production-k8s/#the-preferred-deployment-method">guide</a>
and set <code>registry.secretName=your-registry-credentials-secret-name</code> in the <code>values.override.yaml</code> file.</p>
</li>
<li>
<p>In the case of using Minikube, you can run a local unsecured registry with minikube add-ons:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">minikube addons <span style="color:#204a87">enable</span> registry
minikube addons <span style="color:#204a87">enable</span> registry-aliases
</code></pre></div><p>Before Docker container images can be pushed to your newly created insecure registry,
you need to add its address (<code>$(minikube ip):5000</code>) to the list of insecure registries to
instruct Docker to accept working against it:
follow the instructions in the <a href="https://docs.docker.com/registry/insecure/#deploy-a-plain-http-registry">Docker documentation</a></p>
</li>
</ul>
<p>You might also need to log into your registry account (docker login)
on the installation machine before running the deployment command.</p>
</li>
<li>
<p>Create cvat project:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">nuctl --namespace &lt;your cvat namespace&gt; create project cvat
</code></pre></div></li>
<li>
<p>Finally deploy the function, i.e.:</p>
<ul>
<li>using minikube registry:
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">nuctl deploy --project-name cvat --path serverless/tensorflow/faster_rcnn_inception_v2_coco/nuclio --registry <span style="color:#204a87;font-weight:bold">$(</span>minikube ip<span style="color:#204a87;font-weight:bold">)</span>:5000 --run-registry registry.minikube
</code></pre></div></li>
<li>using Docker hub:
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">nuctl deploy --project-name cvat --path serverless/tensorflow/faster_rcnn_inception_v2_coco/nuclio --registry docker.io/your_username
</code></pre></div></li>
</ul>
</li>
</ol>
<h3 id="analytics">Analytics</h3>
<p>Analytics is enabled by default, to disable set <code>analytics.enabled: false</code> in your <code>values.override.yaml</code></p>
<h2 id="deployment">Deployment</h2>
<p>Make sure you are using correct kubernetes context. You can check it with <code>kubectl config current-context</code>.</p>
<blockquote>
<p><strong>Warning:</strong> The k8s service name of Open Policy Agent is fixed to opa by default.
This is done to be compatible with CVAT 2.0 but limits this helm chart to a single release per namespace.
The OPA url currently can´t be set as an environment variable.
As soon as this is possible you can set cvat.opa.composeCompatibleServiceName
to false in your value.override.yaml and configure the opa url as additional env.</p>
</blockquote>
<p>Execute following command from repo root directory</p>
<h3 id="with-overrides">With overrides:</h3>
<p><code>helm upgrade -n &lt;desired_namespace&gt; &lt;release_name&gt; -i --create-namespace ./helm-chart -f ./helm-chart/values.yaml  -f ./helm-chart/values.override.yaml</code></p>
<h3 id="without-overrides">Without overrides:</h3>
<p><code>helm upgrade -n &lt;desired_namespace&gt; &lt;release_name&gt; -i --create-namespace ./helm-chart -f ./helm-chart/values.yaml</code></p>
<h2 id="post-deployment-configuration">Post-deployment configuration</h2>
<ol>
<li>Create <a href="#how-to-create-superuser">super user</a></li>
</ol>
<h3 id="how-to-create-superuser">How to create superuser?</h3>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#000">HELM_RELEASE_NAMESPACE</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;desired_namespace&gt;&#34;</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span><span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#000">HELM_RELEASE_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;release_name&gt;&#34;</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span><span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span><span style="color:#000">BACKEND_POD_NAME</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>kubectl get pod --namespace <span style="color:#000">$HELM_RELEASE_NAMESPACE</span> -l <span style="color:#000">tier</span><span style="color:#ce5c00;font-weight:bold">=</span>backend,app.kubernetes.io/instance<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$HELM_RELEASE_NAME</span> -o <span style="color:#000">jsonpath</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;{.items[0].metadata.name}&#39;</span><span style="color:#204a87;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span><span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>kubectl <span style="color:#204a87">exec</span> -it --namespace <span style="color:#000">$HELM_RELEASE_NAMESPACE</span> <span style="color:#000">$BACKEND_POD_NAME</span> -c cvat-backend-app-container -- python manage.py createsuperuser
</code></pre></div><h2 id="faq">FAQ</h2>
<h3 id="what-is-kubernetes-and-how-it-is-working">What is kubernetes and how it is working?</h3>
<p>See <a href="https://kubernetes.io/">https://kubernetes.io/</a></p>
<h3 id="what-is-helm-and-how-it-is-working">What is helm and how it is working?</h3>
<p>See <a href="https://helm.sh/">https://helm.sh/</a></p>
<h3 id="how-to-setup-minikube">How to setup Minikube</h3>
<ol>
<li>Please follow the official Minikube installation <a href="https://minikube.sigs.k8s.io/docs/start/">guide</a></li>
<li>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">minikube start --addons registry,registry-aliases
</code></pre></div></li>
</ol>
<h3 id="how-to-understand-what-diff-will-be-inflicted-by-helm-upgrade">How to understand what diff will be inflicted by &lsquo;helm upgrade&rsquo;?</h3>
<p>You can use <a href="https://github.com/databus23/helm-diff#install">https://github.com/databus23/helm-diff#install</a> for that</p>
<h3 id="i-want-to-use-my-own-postgresql-with-your-chart">I want to use my own postgresql with your chart.</h3>
<p>Just set <code>postgresql.enabled</code> to <code>false</code> in the override file, then put the parameters of your database
instance in the <code>external</code> field.
You may also need to configure <code>username</code>, <code>database</code> and <code>password</code> fields
to connect to your own database:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">postgresql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">external</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">postgresql.default.svc.cluster.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5432</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">auth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat_postgresql</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>In example above corresponding secret will be created automatically, but if you want to use existing secret change <code>secret.create</code> to <code>false</code> and set <code>name</code> of existing secret:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">postgresql</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">external</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">postgresql.default.svc.cluster.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">5432</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">create</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-postgresql-secret&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>The secret must contain the <code>database</code>, <code>username</code> and <code>password</code>
keys to access to the database
like:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-postgresql-secret&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">generic</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stringData</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">database</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secretpassword</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="i-want-to-use-my-own-redis-with-your-chart">I want to use my own redis with your chart.</h3>
<p>Just set <code>redis.enabled</code> to <code>false</code> in the override file, then put the parameters of your Redis
instance in the <code>external</code> field.
You may also need to configure <code>password</code> field to connect to your own Redis:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">redis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">external</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis.hostname.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat_redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>In the above example the corresponding secret will be created automatically, but if you want to use an existing secret
change <code>secret.create</code> to <code>false</code> and set <code>name</code> of the existing secret:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">redis</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">external</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">host</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis.hostname.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">secret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">create</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-redis-secret&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>The secret must contain the <code>redis-password</code> key like:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">apiVersion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Secret</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">metadata</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;my-redis-secret&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">namespace</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">default</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">generic</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stringData</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">redis-password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">secretpassword</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="i-want-to-override-some-settings-in-valuesyaml">I want to override some settings in values.yaml.</h3>
<p>Just create file <code>values.override.yaml</code> and place your changes here, using same structure as in <code>values.yaml</code>.
Then reference it in helm update/install command using <code>-f</code> flag</p>
<h3 id="why-you-used-external-charts-to-provide-redis-and-postgres">Why you used external charts to provide redis and postgres?</h3>
<p>Because they definitely know what they do better then we are, so we are getting more quality and less support</p>
<h3 id="how-to-use-custom-domain-name-with-k8s-deployment">How to use custom domain name with k8s deployment:</h3>
<p>The default value <code>cvat.local</code> may be overridden with <code>--set ingress.hosts[0].host</code> option like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">helm upgrade -n default cvat -i --create-namespace helm-chart -f helm-chart/values.yaml -f helm-chart/values.override.yaml --set ingress.hosts<span style="color:#ce5c00;font-weight:bold">[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.host<span style="color:#ce5c00;font-weight:bold">=</span>YOUR_FQDN
</code></pre></div><h3 id="how-to-fix-fail-of-helm-upgrade-due-label-field-is-immutable-reason">How to fix fail of <code>helm upgrade</code> due label field is immutable reason?</h3>
<p>If an error message like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Error: UPGRADE FAILED:cannot patch <span style="color:#4e9a06">&#34;cvat-backend-server&#34;</span> with kind Deployment: Deployment.apps <span style="color:#4e9a06">&#34;cvat-backend-server&#34;</span> is invalid: spec.selector: Invalid value: v1.LabelSelector<span style="color:#ce5c00;font-weight:bold">{</span>MatchLabels:map<span style="color:#ce5c00;font-weight:bold">[</span>string<span style="color:#ce5c00;font-weight:bold">]</span>string<span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;app&#34;</span>:<span style="color:#4e9a06">&#34;cvat-app&#34;</span>, <span style="color:#4e9a06">&#34;app.kubernetes.io/instance&#34;</span>:<span style="color:#4e9a06">&#34;cvat&#34;</span>, <span style="color:#4e9a06">&#34;app.kubernetes.io/managed-by&#34;</span>:<span style="color:#4e9a06">&#34;Helm&#34;</span>, <span style="color:#4e9a06">&#34;app.kubernetes.io/name&#34;</span>:<span style="color:#4e9a06">&#34;cvat&#34;</span>, <span style="color:#4e9a06">&#34;app.kubernetes.io/version&#34;</span>:<span style="color:#4e9a06">&#34;latest&#34;</span>, <span style="color:#4e9a06">&#34;component&#34;</span>:<span style="color:#4e9a06">&#34;server&#34;</span>, <span style="color:#4e9a06">&#34;helm.sh/chart&#34;</span>:<span style="color:#4e9a06">&#34;cvat&#34;</span>, <span style="color:#4e9a06">&#34;tier&#34;</span>:<span style="color:#4e9a06">&#34;backend&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span>, MatchExpressions:<span style="color:#ce5c00;font-weight:bold">[]</span>v1.LabelSelectorRequirement<span style="color:#ce5c00;font-weight:bold">(</span>nil<span style="color:#ce5c00;font-weight:bold">)}</span>: field is immutable
</code></pre></div><p>To fix that, delete CVAT Deployments before upgrading</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">kubectl delete deployments --namespace<span style="color:#ce5c00;font-weight:bold">=</span>foo -l <span style="color:#000">app</span><span style="color:#ce5c00;font-weight:bold">=</span>cvat-app
</code></pre></div><h3 id="how-to-use-existing-persistentvolume-to-store-cvat-data-instead-of-default-storage">How to use existing PersistentVolume to store CVAT data instead of default storage</h3>
<p>It is assumed that you have created a PersistentVolumeClaim named <code>my-claim-name</code>
and a PersistentVolume that backing the claim.
Claims must exist in the same namespace as the Pod using the claim.
For details <a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes">see</a>.
Add these values in the <code>values.override.yaml</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">cvat</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">backend</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">permissionFix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">defaultStorage</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">enabled</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">server</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">additionalVolumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat-backend-data</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">persistentVolumeClaim</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">claimName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-claim-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">worker</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">export</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">additionalVolumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat-backend-data</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">persistentVolumeClaim</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">claimName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-claim-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">import</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">additionalVolumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat-backend-data</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">persistentVolumeClaim</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">claimName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-claim-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">annotation</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">additionalVolumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat-backend-data</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">persistentVolumeClaim</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span><span style="color:#204a87;font-weight:bold">claimName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-claim-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">utils</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">additionalVolumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat-backend-data</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">persistentVolumeClaim</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">claimName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-claim-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0525160925e6dcda34a919060abed2a7">2 - Semi-automatic and Automatic Annotation</h1>
    <div class="lead">Information about the installation of components needed for semi-automatic and automatic annotation.</div>
	<blockquote>
<p><strong>⚠ WARNING: Do not use <code>docker compose up</code></strong>
If you did, make sure all containers are stopped by <code>docker compose down</code>.</p>
</blockquote>
<ul>
<li>
<p>To bring up cvat with auto annotation tool, from cvat root directory, you need to run:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker compose -f docker-compose.yml -f components/serverless/docker-compose.serverless.yml up -d
</code></pre></div><p>If you did any changes to the Docker Compose files, make sure to add <code>--build</code> at the end.</p>
<p>To stop the containers, simply run:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker compose -f docker-compose.yml -f components/serverless/docker-compose.serverless.yml down
</code></pre></div></li>
<li>
<p>You have to install <code>nuctl</code> command line tool to build and deploy serverless
functions. Download <a href="https://github.com/nuclio/nuclio/releases/tag/1.11.24">version 1.11.24</a>.
It is important that the version you download matches the version in
<a href="https://github.com/cvat-ai/cvat/blob/develop/components/serverless/docker-compose.serverless.yml">docker-compose.serverless.yml</a>.
For example, using wget.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://github.com/nuclio/nuclio/releases/download/&lt;version&gt;/nuctl-&lt;version&gt;-linux-amd64
</code></pre></div><p>After downloading the nuclio, give it a proper permission and do a softlink.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chmod +x nuctl-&lt;version&gt;-linux-amd64
sudo ln -sf <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/nuctl-&lt;version&gt;-linux-amd64 /usr/local/bin/nuctl
</code></pre></div></li>
<li>
<p>Deploy a couple of functions.
This will automatically create a <code>cvat</code> Nuclio project to contain the functions.
Commands below should be run only after CVAT has been installed
using <code>docker compose</code> because it runs nuclio dashboard which manages all serverless functions.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./serverless/deploy_cpu.sh serverless/openvino/dextr
./serverless/deploy_cpu.sh serverless/openvino/omz/public/yolo-v3-tf
</code></pre></div><h4 id="gpu-support">GPU Support</h4>
<p>You will need to install <a href="https://www.tensorflow.org/install/docker#gpu_support">Nvidia Container Toolkit</a>.
Also you will need to add <code>--resource-limit nvidia.com/gpu=1 --triggers '{&quot;myHttpTrigger&quot;: {&quot;maxWorkers&quot;: 1}}'</code> to
the nuclio deployment command. You can increase the maxWorker if you have enough GPU memory.
As an example, below will run on the GPU:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nuctl deploy --project-name cvat <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --path serverless/tensorflow/matterport/mask_rcnn/nuclio <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --platform <span style="color:#204a87">local</span> --base-image tensorflow/tensorflow:1.15.5-gpu-py3 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --desc <span style="color:#4e9a06">&#34;GPU based implementation of Mask RCNN on Python 3, Keras, and TensorFlow.&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --image cvat/tf.matterport.mask_rcnn_gpu <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --triggers <span style="color:#4e9a06">&#39;{&#34;myHttpTrigger&#34;: {&#34;maxWorkers&#34;: 1}}&#39;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-limit nvidia.com/gpu<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</code></pre></div><p><strong>Note:</strong></p>
<ul>
<li>The number of GPU deployed functions will be limited to your GPU memory.</li>
<li>See <a href="https://github.com/cvat-ai/cvat/blob/develop/serverless/deploy_gpu.sh">deploy_gpu.sh</a>
script for more examples.</li>
<li>For some models (namely <a href="../../../../docs/manual/advanced/ai-tools#trackers">SiamMask</a>) you need an <a href="https://www.nvidia.com/en-us/drivers/unix/">Nvidia driver</a>
version greater than or equal to 450.80.02.</li>
</ul>
<p><strong>Note for Windows users:</strong></p>
<p>If you want to use nuclio under Windows CVAT installation you should install Nvidia drivers for WSL according to
<a href="https://docs.nvidia.com/cuda/wsl-user-guide/index.html">this</a> instruction and follow the steps up to “2.3 Installing Nvidia drivers”.
Important requirement: you should have the latest versions of Docker Desktop, Nvidia drivers for WSL,
and the latest updates from the Windows Insider Preview Dev channel.</p>
</li>
</ul>
<p><strong>Troubleshooting Nuclio Functions:</strong></p>
<ul>
<li>
<p>You can open nuclio dashboard at <a href="http://localhost:8070">localhost:8070</a>.
Make sure status of your functions are up and running without any error.</p>
</li>
<li>
<p>Test your deployed DL model as a serverless function. The command below should work on Linux and Mac OS.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">image</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>curl https://upload.wikimedia.org/wikipedia/en/7/7d/Lenna_%28test_image%29.png --output - <span style="color:#000;font-weight:bold">|</span> base64 <span style="color:#000;font-weight:bold">|</span> tr -d <span style="color:#4e9a06">&#39;\n&#39;</span><span style="color:#204a87;font-weight:bold">)</span>
cat <span style="color:#4e9a06">&lt;&lt; EOF &gt; /tmp/input.json
</span><span style="color:#4e9a06">{&#34;image&#34;: &#34;$image&#34;}
</span><span style="color:#4e9a06">EOF</span>
cat /tmp/input.json <span style="color:#000;font-weight:bold">|</span> nuctl invoke openvino-omz-public-yolo-v3-tf -c <span style="color:#4e9a06">&#39;application/json&#39;</span>
</code></pre></div><details>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">20.07.17 12:07:44.519    nuctl.platform.invoker <span style="color:#ce5c00;font-weight:bold">(</span>I<span style="color:#ce5c00;font-weight:bold">)</span> Executing <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;method&#34;</span>: <span style="color:#4e9a06">&#34;POST&#34;</span>, <span style="color:#4e9a06">&#34;url&#34;</span>: <span style="color:#4e9a06">&#34;http://:57308&#34;</span>, <span style="color:#4e9a06">&#34;headers&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;Content-Type&#34;</span>:<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>,<span style="color:#4e9a06">&#34;X-Nuclio-Log-Level&#34;</span>:<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;info&#34;</span><span style="color:#ce5c00;font-weight:bold">]</span>,<span style="color:#4e9a06">&#34;X-Nuclio-Target&#34;</span>:<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">&#34;openvino-omz-public-yolo-v3-tf&#34;</span><span style="color:#ce5c00;font-weight:bold">]}}</span>
20.07.17 12:07:45.275    nuctl.platform.invoker <span style="color:#ce5c00;font-weight:bold">(</span>I<span style="color:#ce5c00;font-weight:bold">)</span> Got response <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;status&#34;</span>: <span style="color:#4e9a06">&#34;200 OK&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span>
20.07.17 12:07:45.275                     nuctl <span style="color:#ce5c00;font-weight:bold">(</span>I<span style="color:#ce5c00;font-weight:bold">)</span> &gt;&gt;&gt; Start of <span style="color:#204a87;font-weight:bold">function</span> logs
20.07.17 12:07:45.275 ino-omz-public-yolo-v3-tf <span style="color:#ce5c00;font-weight:bold">(</span>I<span style="color:#ce5c00;font-weight:bold">)</span> Run yolo-v3-tf model <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#4e9a06">&#34;worker_id&#34;</span>: <span style="color:#4e9a06">&#34;0&#34;</span>, <span style="color:#4e9a06">&#34;time&#34;</span>: 1594976864570.9353<span style="color:#ce5c00;font-weight:bold">}</span>
20.07.17 12:07:45.275                     nuctl <span style="color:#ce5c00;font-weight:bold">(</span>I<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;&lt;</span> End of <span style="color:#204a87;font-weight:bold">function</span> logs

&gt; Response headers:
<span style="color:#000">Date</span> <span style="color:#ce5c00;font-weight:bold">=</span> Fri, <span style="color:#0000cf;font-weight:bold">17</span> Jul <span style="color:#0000cf;font-weight:bold">2020</span> 09:07:45 GMT
Content-Type <span style="color:#ce5c00;font-weight:bold">=</span> application/json
Content-Length <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">100</span>
<span style="color:#000">Server</span> <span style="color:#ce5c00;font-weight:bold">=</span> nuclio

&gt; Response body:
<span style="color:#ce5c00;font-weight:bold">[</span>
    <span style="color:#ce5c00;font-weight:bold">{</span>
        <span style="color:#4e9a06">&#34;confidence&#34;</span>: <span style="color:#4e9a06">&#34;0.9992254&#34;</span>,
        <span style="color:#4e9a06">&#34;label&#34;</span>: <span style="color:#4e9a06">&#34;person&#34;</span>,
        <span style="color:#4e9a06">&#34;points&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[</span>
            39,
            124,
            408,
            <span style="color:#0000cf;font-weight:bold">512</span>
        <span style="color:#ce5c00;font-weight:bold">]</span>,
        <span style="color:#4e9a06">&#34;type&#34;</span>: <span style="color:#4e9a06">&#34;rectangle&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">}</span>
<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div></details>
</li>
<li>
<p>To check for internal server errors, run <code>docker ps -a</code> to see the list of containers.
Find the container that you are interested, e.g., <code>nuclio-nuclio-tf-faster-rcnn-inception-v2-coco-gpu</code>.
Then check its logs by <code>docker logs &lt;name of your container&gt;</code>
e.g.,</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker logs nuclio-nuclio-tf-faster-rcnn-inception-v2-coco-gpu
</code></pre></div></li>
<li>
<p>To debug a code inside a container, you can use vscode to attach to a container <a href="https://code.visualstudio.com/docs/remote/attach-container">instructions</a>.
To apply your changes, make sure to restart the container.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker restart &lt;name_of_the_container&gt;
</code></pre></div></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-510d3a6059194f92357d8aa6f6ce7693">3 - CVAT Analytics and monitoring</h1>
    <div class="lead">Instructions for deployment and customization of analytics and monitoring.</div>
	<p>CVAT Analytics suite of tools is designed to track and understand users' behavior, system performance,
and for identifying potential issues in your application.</p>
<p>You can also visualize user activity through Grafana, and aggregate user
working time by the jobs.</p>
<p>Gathered logs can be additionally filtered for efficient debugging.</p>
<p>By using analytics, you&rsquo;ll gain valuable insights to optimize your system
and enhance user satisfaction.</p>
<p>CVAT analytics are available from the top menu.</p>
<p><img src="../../../../images/analytics_menu.jpg" alt="CVAT Analytics"></p>
<blockquote>
<p>Note: CVAT analytics and monitoring are available only for on-prem solution.</p>
</blockquote>
<p>See:</p>
<ul>
<li><a href="#high-level-architecture">High-level architecture</a></li>
<li><a href="#cvat-analytics">CVAT Analytics</a>
<ul>
<li><a href="#ports-settings">Ports settings</a></li>
<li><a href="#events-log-structure">Events log structure</a></li>
<li><a href="#types-of-supported-events">Types of supported events</a></li>
<li><a href="#request-id-for-tracking">Request <code>id</code> for tracking</a></li>
<li><a href="#fetching-event-data-as-csv-from-the-apievents-endpoint">Fetching event data as CSV from the <code>/api/events</code> endpoint</a></li>
</ul>
</li>
<li><a href="#dashboards">Dashboards</a>
<ul>
<li><a href="#dashboard-all-events">Dashboard: All Events</a></li>
<li><a href="#dashboard-management">Dashboard: Management</a></li>
<li><a href="#dashboard-monitoring">Dashboard: Monitoring</a></li>
<li><a href="#dashboards-setup">Dashboards setup</a></li>
</ul>
</li>
<li><a href="#example-of-use">Example of use</a></li>
</ul>
<h2 id="high-level-architecture">High-level architecture</h2>
<p>The CVAT analytics is based on Vector, ClickHouse, and Grafana.</p>
<p><img src="../../../../images/analytic_architecture.jpg" alt="CVAT Analytics"></p>
<h2 id="cvat-analytics">CVAT Analytics</h2>
<p>CVAT and its analytics module can be set up locally, for
self-hosted solution analytics are enabled by default.</p>
<blockquote>
<p>For detailed instructions for CVAT installation, see <a href="https://opencv.github.io/cvat/docs/administration/basics/installation/">Installation Guide</a>
or refer to the <a href="https://www.youtube.com/playlist?list=PL0to7Ng4PuuYQT4eXlHb_oIlq_RPeuasN">CVAT Course</a>
for installation videos.</p>
</blockquote>
<p>All analytics-related features will be launched when you
start CVAT containers with the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose up -d
</code></pre></div><h3 id="ports-settings">Ports settings</h3>
<p>If you cannot access analytics on
development environnement,
see <a href="../../../../docs/contributing/development-environment/#cvat-analytics-ports">Analytics Ports</a></p>
<h3 id="events-log-structure">Events log structure</h3>
<p><a href="https://github.com/opencv/cvat/blob/develop/components/analytics/clickhouse/init.sh">Relational database</a>
schema with the following fields:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>scope</td>
<td>Scope of the event (e.g., <code>zoomin:image</code>, <code>add:annotations</code>, <code>delete:image</code>, <code>update:assignee</code>).</td>
</tr>
<tr>
<td>obj_name</td>
<td>Object name or None (e.g., task, job, cloudstorage, model, organization).</td>
</tr>
<tr>
<td>obj_id</td>
<td>Object identifier as in DB or None.</td>
</tr>
<tr>
<td>obj_val</td>
<td>Value for the event as string or None (e.g., frame number, number of added annotations).</td>
</tr>
<tr>
<td>source</td>
<td>Who generates the log event (e.g., server, ui).</td>
</tr>
<tr>
<td>timestamp</td>
<td>Local event time (in general for UI and server, the time is different).</td>
</tr>
<tr>
<td>count</td>
<td>How many times in the row it occurs.</td>
</tr>
<tr>
<td>duration</td>
<td>How much time does it take (it can be 0 for events without duration).</td>
</tr>
<tr>
<td>project_id</td>
<td>Project ID or None.</td>
</tr>
<tr>
<td>task_id</td>
<td>Task ID or None.</td>
</tr>
<tr>
<td>job_id</td>
<td>Job ID or None.</td>
</tr>
<tr>
<td>user_id</td>
<td>User ID or None.</td>
</tr>
<tr>
<td>user_name</td>
<td>User name or None.</td>
</tr>
<tr>
<td>user_email</td>
<td>User email or None.</td>
</tr>
<tr>
<td>org_id</td>
<td>Organization ID or None.</td>
</tr>
<tr>
<td>org_slug</td>
<td>Organization slug or None.</td>
</tr>
<tr>
<td>payload</td>
<td>JSON payload or None. Extra fields can be added to the JSON blob.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<h3 id="types-of-supported-events">Types of supported events</h3>
<p>Supported events change the scope of information displayed in Grafana.</p>
<p><img src="../../../../images/supported_events.jpg" alt="Supported Events"></p>
<!--lint disable maximum-line-length-->
<p>Server events:</p>
<ul>
<li>
<p><code>create:project</code>, <code>update:project</code>, <code>delete:project</code></p>
</li>
<li>
<p><code>create:task</code>, <code>update:task</code>, <code>delete:task</code></p>
</li>
<li>
<p><code>create:job</code>, <code>update:job</code>, <code>delete:job</code></p>
</li>
<li>
<p><code>create:organization</code>, <code>update:organization</code>, <code>delete:organization</code></p>
</li>
<li>
<p><code>create:user</code>, <code>update:user</code>, <code>delete:user</code></p>
</li>
<li>
<p><code>create:cloudstorage</code>, <code>update:cloudstorage</code>, <code>delete:cloudstorage</code></p>
</li>
<li>
<p><code>create:issue</code>, <code>update:issue</code>, <code>delete:issue</code></p>
</li>
<li>
<p><code>create:comment</code>, <code>update:comment</code>, <code>delete:comment</code></p>
</li>
<li>
<p><code>create:annotations</code>, <code>update:annotations</code>, <code>delete:annotations</code></p>
</li>
<li>
<p><code>create:label</code>, <code>update:label</code>, <code>delete:label</code></p>
</li>
</ul>
<p>Client events:</p>
<ul>
<li>
<p><code>load:cvat</code></p>
</li>
<li>
<p><code>load:job</code>, <code>save:job</code>, <code>restore:job</code></p>
</li>
<li>
<p><code>upload:annotations</code></p>
</li>
<li>
<p><code>send:exception</code></p>
</li>
<li>
<p><code>send:task_info</code></p>
</li>
<li>
<p><code>draw:object</code>, <code>paste:object</code>, <code>copy:object</code>, <code>propagate:object</code>, <code>drag:object</code>, <code>resize:object</code>, <code>delete:object</code>, <code>lock:object</code>, <code>merge:objects</code></p>
</li>
<li>
<p><code>change:attribute</code></p>
</li>
<li>
<p><code>change:label</code></p>
</li>
<li>
<p><code>change:frame</code></p>
</li>
<li>
<p><code>move:image</code>, <code>zoom:image</code>, <code>fit:image</code>, <code>rotate:image</code></p>
</li>
<li>
<p><code>action:undo</code>, <code>action:redo</code></p>
</li>
<li>
<p><code>press:shortcut</code></p>
</li>
<li>
<p><code>send:debug_info</code></p>
</li>
<li>
<p><code>click:element</code></p>
</li>
</ul>
<!--lint enable maximum-line-length-->
<h3 id="request-id-for-tracking">Request <code>id</code> for tracking</h3>
<p>Note, that every response to an API request made to the
the server includes a header named <code>X-Request-Id</code>,
for example: <code>X-Request-Id: 6a2b7102-c4b9-4d57-8754-5658132ba37d</code>.</p>
<p>This identifier is also recorded in all server events that
occur as a result of the respective request.</p>
<p>For example, when an operation to create a task is performed,
other related entities such as labels and attributes are
generated on the server in addition to the <strong>Task</strong> object.</p>
<p>All events associated with this operation will have the same <code>request_id</code> in
the payload field.</p>
<h3 id="fetching-event-data-as-csv-from-the-apievents-endpoint">Fetching event data as CSV from the <code>/api/events</code> endpoint</h3>
<!--lint disable maximum-line-length-->
<p>The <code>/api/events</code> endpoint allows the fetching of
event data with filtering parameters such as
<code>org_id</code>, <code>project_id</code>, <code>task_id</code>, <code>job_id</code>, and <code>user_id</code>.</p>
<p>For more details,
see <a href="https://app.cvat.ai/api/swagger/#/events/events_list">Swagger API Documentation</a>.</p>
<p>For example, to fetch all events associated with a specific job,
the following <code>curl</code> command can be used:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl --user <span style="color:#4e9a06">&#39;user:pass&#39;</span> https://app.cvat.ai/api/events?job_id<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">123</span>
</code></pre></div><p>In the response, you will receive a query ID:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">&#34;query_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;150cac1f-09f1-4d73-b6a5-5f47aa5d0031&#34;</span> <span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>As this process may take some time to complete,
the status of the request can be checked by
adding the query parameter <code>query_id</code> to the request:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -I --user <span style="color:#4e9a06">&#39;user:pass&#39;</span> https://app.cvat.ai/api/events?job_id<span style="color:#ce5c00;font-weight:bold">=</span>123<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000">query_id</span><span style="color:#ce5c00;font-weight:bold">=</span>150cac1f-09f1-4d73-b6a5-5f47aa5d0031
</code></pre></div><p>Upon successful creation, the server will return a <code>201 Created</code> status:</p>
<pre><code>HTTP/2 201
allow: GET, POST, HEAD, OPTIONS
date: Tue, 16 May 2023 13:38:42 GMT
referrer-policy: same-origin
server: Apache
vary: Accept,Origin,Cookie
x-content-type-options: nosniff
x-frame-options: DENY
x-request-id: 4631f5fa-a4f0-42a8-b77b-7426fc298a85
</code></pre><p>The CSV file can be downloaded by
adding the <code>action=download</code> query parameter to the request:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl --user <span style="color:#4e9a06">&#39;user:pass&#39;</span> https://app.cvat.ai/api/events?job_id<span style="color:#ce5c00;font-weight:bold">=</span>123<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000">query_id</span><span style="color:#ce5c00;font-weight:bold">=</span>150cac1f-09f1-4d73-b6a5-5f47aa5d0031<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#000">action</span><span style="color:#ce5c00;font-weight:bold">=</span>download &gt; /tmp/events.csv
</code></pre></div><p>This will download and save the file to <code>/tmp/events.csv</code>
on your local machine.</p>
<!--lint enable maximum-line-length-->
<h2 id="dashboards">Dashboards</h2>
<p>By default, three dashboards are available in CVAT.</p>
<p>To access them, click <strong>General</strong>, you will be forwarded to the
page with available dashboards.</p>
<p><img src="../../../../images/dashboard_00.jpg" alt="List of dashboards"></p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Dashboard</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>All Events</strong></td>
<td>Dashboard that shows all event logs, timestamps, and source.</td>
</tr>
<tr>
<td><strong>Management</strong></td>
<td>Dashboard with information about user activities such as working time by job and so on.</td>
</tr>
<tr>
<td><strong>Monitoring</strong></td>
<td>Dashboard showing server logs, including errors.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<h3 id="dashboard-all-events">Dashboard: All Events</h3>
<p>The dashboard shows all events, their timestamps, and their source.</p>
<p><img src="../../../../images/dashboard_01.jpg" alt="Dashboard: All Events"></p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Filters</strong></td>
<td>Can be used as drop-down lists or search fields. Click on the arrow to activate.</td>
</tr>
<tr>
<td><strong>Overall activity</strong></td>
<td>Graph that shows the overall activity by the selected filters.</td>
</tr>
<tr>
<td><strong>Scope</strong></td>
<td>Users' activity, see <a href="#types-of-supported-events">Types of supported events</a>.</td>
</tr>
<tr>
<td><strong>obj_name</strong></td>
<td>Object or item related to the <strong>Scope</strong>.</td>
</tr>
<tr>
<td><strong>obj_id</strong></td>
<td>Object&rsquo;s id. Might be empty.</td>
</tr>
<tr>
<td><strong>source</strong></td>
<td>Source of the event, can be <code>client</code> or <code>server</code>.</td>
</tr>
<tr>
<td><strong>timestamp</strong></td>
<td>Time when the event happened.</td>
</tr>
<tr>
<td><strong>count</strong></td>
<td>Common field for all events, not null where it makes sense, for example, the <br>number of saved objects in an annotation.</td>
</tr>
<tr>
<td><strong>duration</strong></td>
<td>Duration in milliseconds.</td>
</tr>
<tr>
<td><strong>project_id</strong></td>
<td>Id of the project.</td>
</tr>
<tr>
<td><strong>project_id</strong></td>
<td>Id of the project.</td>
</tr>
<tr>
<td><strong>task_id</strong></td>
<td>ID of the task.</td>
</tr>
<tr>
<td><strong>job_id</strong></td>
<td>ID of the job.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>There are two fields with statistics at the bottom of the dashboard,
about browser and OS users use.</p>
<p>Click on the column name to enable a filter.</p>
<p>If you want to inspect the value, hover over it and click
on the eye icon.</p>
<h3 id="dashboard-management">Dashboard: Management</h3>
<p>The dashboard shows user activity.</p>
<p><img src="../../../../images/dashboard_02.jpg" alt="Dashboard: Management"></p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Filters</strong></td>
<td>Can be used as drop-down lists or search fields. Click on the arrow to activate.</td>
</tr>
<tr>
<td><strong>User activity</strong></td>
<td>Graph that shows when the user was active (data and time), click on the user id below, to see the graph for the dedicated user.</td>
</tr>
<tr>
<td><strong>Overall activity</strong></td>
<td>Graph shows common activity for all users.</td>
</tr>
<tr>
<td><strong>User</strong></td>
<td>User ID.</td>
</tr>
<tr>
<td><strong>Project</strong></td>
<td>Project ID. Might be empty.</td>
</tr>
<tr>
<td><strong>Task</strong></td>
<td>Task ID. Might be empty.</td>
</tr>
<tr>
<td><strong>Job</strong></td>
<td>Job ID. Might be empty.</td>
</tr>
<tr>
<td><strong>Working time(h)</strong></td>
<td>Time spent on task in hours.</td>
</tr>
<tr>
<td><strong>Activity</strong></td>
<td>Number of events for each user.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>Click on the column name to enable a filter.</p>
<p>If you want to inspect the value, hover over it and click
on the eye icon.</p>
<h3 id="dashboard-monitoring">Dashboard: Monitoring</h3>
<p>The dashboard shows server logs, helps handle errors, and shows user activity.</p>
<p><img src="../../../../images/dashboard_03.jpg" alt="Dashboard: Monitoring"></p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Filters</strong></td>
<td>Can be used as drop-down lists or search fields. Click on the arrow to activate.</td>
</tr>
<tr>
<td><strong>Active users (now)</strong></td>
<td>Number of active users on an instance.</td>
</tr>
<tr>
<td><strong>Overall activity</strong></td>
<td>Graph that shows the number of active users.</td>
</tr>
<tr>
<td><strong>Exceptions</strong></td>
<td>Graph that shows the number of errors that happened in the instance.</td>
</tr>
<tr>
<td><strong>timestamp</strong></td>
<td>Time when the error happened.</td>
</tr>
<tr>
<td><strong>user_id</strong></td>
<td>User ID.</td>
</tr>
<tr>
<td><strong>user_name</strong></td>
<td>User nickname.</td>
</tr>
<tr>
<td><strong>project_id</strong></td>
<td>Id of the project. Might be empty.</td>
</tr>
<tr>
<td><strong>task_id</strong></td>
<td>Task ID. Might be empty.</td>
</tr>
<tr>
<td><strong>job_id</strong></td>
<td>Job ID. Might be empty.</td>
</tr>
<tr>
<td><strong>error</strong></td>
<td>Error description</td>
</tr>
<tr>
<td><strong>stack</strong></td>
<td>Error description</td>
</tr>
<tr>
<td><strong>payload</strong></td>
<td>Error description</td>
</tr>
<tr>
<td><strong>stack</strong></td>
<td>Stack trace, which is a report of the active stack frames at a certain point in time during the execution. This information is typically used for debugging purposes to locate where an issue occurred.</td>
</tr>
<tr>
<td><strong>payload</strong></td>
<td>JSON that describes the entire object, which contains several properties. This data in the payload is related to an event that was created as a result of a failed API request. The payload contains information about this event.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>Click on the column name to enable a filter.</p>
<p>If you want to inspect the value, hover over it and click
on the eye icon.</p>
<h3 id="dashboards-setup">Dashboards setup</h3>
<p>You can adjust the dashboards. To do this, click on the
graph or table name and from the drop-down menu select <strong>Edit</strong>.</p>
<p>Adjust the query in the editor.</p>
<p><img src="../../../../images/dashboard_04.jpg" alt="Dashboard: look and feel"></p>
<p>Example of query:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#204a87;font-weight:bold">SELECT</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">time</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">uniqExact</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">user_id</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Users</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">(</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">SELECT</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">user_id</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">toStartOfInterval</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">timestamp</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87">INTERVAL</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">minute</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">as</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cvat</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">events</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">WHERE</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">user_id</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">IS</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">NOT</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">NULL</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">GROUP</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">BY</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">user_id</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ORDER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">BY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">ASC</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">WITH</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FILL</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">STEP</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">toIntervalMinute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000;font-weight:bold">)</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">GROUP</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">BY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">ORDER</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">BY</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">time</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><blockquote>
<p><strong>Note</strong>, that by default the updated configuration will not be saved
and will be reset to the default parameters after you restart the
container.</p>
</blockquote>
<p>To save the updated configuration, do the following:</p>
<ol>
<li>
<p><strong>Update Configuration</strong>: Start by making your desired changes in the query.</p>
</li>
<li>
<p><strong>Apply Changes</strong>: Once you&rsquo;ve made your changes,
click the <strong>Apply</strong> button to ensure the changes are implemented.</p>
<p><img src="../../../../images/apply.jpg" alt="Apply changes"></p>
</li>
<li>
<p><strong>Save Configuration</strong>: To save your applied changes, on the top of the dashboard,
click the <strong>Save</strong> button.</p>
<p><img src="../../../../images/save_results.jpg" alt="Apply changes"></p>
</li>
<li>
<p><strong>Replace Configuration File</strong>: After saving, replace the existing
Grafana dashboard configuration file is located at
<code>components/analytics/grafana/dashboards</code> with the new JSON configuration file.</p>
<p><img src="../../../../images/save_json.jpg" alt="Apply changes"></p>
</li>
<li>
<p><strong>Restart Grafana Service</strong>: To ensure, that all changes take effect,
restart the Grafana service. If you&rsquo;re using Docker Compose,
execute the following command: <code>docker compose restart cvat_grafana</code>.</p>
</li>
</ol>
<p>For more information,
see <a href="https://grafana.com/docs/grafana/latest/dashboards/">Grafana Dashboards</a>.</p>
<h2 id="example-of-use">Example of use</h2>
<p>This video demonstrates available by default CVAT analytics features.</p>
<!--lint disable maximum-line-length-->
<iframe width="560" height="315" src="https://www.youtube.com/embed/-1kiLPidXpI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<!--lint enable maximum-line-length-->

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7545f3c848c8d646b0c6d2ceef722983">4 - Mounting cloud storage</h1>
    <div class="lead">Instructions on how to mount AWS S3 bucket, Microsoft Azure container or Google Drive as a filesystem.</div>
	<!--lint disable heading-style-->
<h2 id="aws-s3-bucket-as-filesystem">AWS S3 bucket as filesystem</h2>
<h3 id="a-nameaws_s3_ubuntu_2004ubuntu-2004a"><a name="aws_s3_ubuntu_2004">Ubuntu 20.04</a></h3>
<h4 id="a-nameaws_s3_mountmounta"><a name="aws_s3_mount">Mount</a></h4>
<ol>
<li>
<p>Install s3fs:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install s3fs
</code></pre></div></li>
<li>
<p>Enter your credentials in a file <code>${HOME}/.passwd-s3fs</code> and set owner-only permissions:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">echo</span> ACCESS_KEY_ID:SECRET_ACCESS_KEY &gt; <span style="color:#4e9a06">${</span><span style="color:#000">HOME</span><span style="color:#4e9a06">}</span>/.passwd-s3fs
chmod <span style="color:#0000cf;font-weight:bold">600</span> <span style="color:#4e9a06">${</span><span style="color:#000">HOME</span><span style="color:#4e9a06">}</span>/.passwd-s3fs
</code></pre></div></li>
<li>
<p>Uncomment <code>user_allow_other</code> in the <code>/etc/fuse.conf</code> file: <code>sudo nano /etc/fuse.conf</code></p>
</li>
<li>
<p>Run s3fs, replace <code>bucket_name</code>, <code>mount_point</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">s3fs &lt;bucket_name&gt; &lt;mount_point&gt; -o allow_other -o <span style="color:#000">passwd_file</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">HOME</span><span style="color:#4e9a06">}</span>/.passwd-s3fs
</code></pre></div></li>
</ol>
<p>For more details see <a href="https://github.com/s3fs-fuse/s3fs-fuse">here</a>.</p>
<h4 id="a-nameaws_s3_automatically_mountautomatically-mounta"><a name="aws_s3_automatically_mount">Automatically mount</a></h4>
<p>Follow the first 3 mounting steps above.</p>
<h5 id="a-nameaws_s3_using_fstabusing-fstaba"><a name="aws_s3_using_fstab">Using fstab</a></h5>
<ol>
<li>
<p>Create a bash script named aws_s3_fuse(e.g in /usr/bin, as root) with this content
(replace <code>user_name</code> on whose behalf the disk will be mounted, <code>backet_name</code>, <code>mount_point</code>, <code>/path/to/.passwd-s3fs</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span><span style="color:#8f5902;font-style:italic"></span>sudo -u &lt;user_name&gt; s3fs &lt;backet_name&gt; &lt;mount_point&gt; -o <span style="color:#000">passwd_file</span><span style="color:#ce5c00;font-weight:bold">=</span>/path/to/.passwd-s3fs -o allow_other
<span style="color:#204a87">exit</span> <span style="color:#0000cf;font-weight:bold">0</span>
</code></pre></div></li>
<li>
<p>Give it the execution permission:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chmod +x /usr/bin/aws_s3_fuse
</code></pre></div></li>
<li>
<p>Edit <code>/etc/fstab</code> adding a line like this, replace <code>mount_point</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/absolute/path/to/aws_s3_fuse  &lt;mount_point&gt;     fuse    allow_other,user,_netdev     <span style="color:#0000cf;font-weight:bold">0</span>       <span style="color:#0000cf;font-weight:bold">0</span>
</code></pre></div></li>
</ol>
<h5 id="a-nameaws_s3_using_systemdusing-systemda"><a name="aws_s3_using_systemd">Using systemd</a></h5>
<ol>
<li>
<p>Create unit file <code>sudo nano /etc/systemd/system/s3fs.service</code>
(replace <code>user_name</code>, <code>bucket_name</code>, <code>mount_point</code>, <code>/path/to/.passwd-s3fs</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>Unit<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span>FUSE filesystem over AWS S3 bucket
<span style="color:#000">After</span><span style="color:#ce5c00;font-weight:bold">=</span>network.target

<span style="color:#ce5c00;font-weight:bold">[</span>Service<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Environment</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;MOUNT_POINT=&lt;mount_point&gt;&#34;</span>
<span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">Group</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>s3fs &lt;bucket_name&gt; <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span> -o <span style="color:#000">passwd_file</span><span style="color:#ce5c00;font-weight:bold">=</span>/path/to/.passwd-s3fs -o allow_other
<span style="color:#000">ExecStop</span><span style="color:#ce5c00;font-weight:bold">=</span>fusermount -u <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span>
<span style="color:#000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span>always
<span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>forking

<span style="color:#ce5c00;font-weight:bold">[</span>Install<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span>multi-user.target
</code></pre></div></li>
<li>
<p>Update the system configurations, enable unit autorun when the system boots, mount the bucket:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl daemon-reload
sudo systemctl <span style="color:#204a87">enable</span> s3fs.service
sudo systemctl start s3fs.service
</code></pre></div></li>
</ol>
<h4 id="a-nameaws_s3_checkchecka"><a name="aws_s3_check">Check</a></h4>
<p>A file <code>/etc/mtab</code> contains records of currently mounted filesystems.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /etc/mtab <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;s3fs&#39;</span>
</code></pre></div><h4 id="a-nameaws_s3_unmount_filesystemunmount-filesystema"><a name="aws_s3_unmount_filesystem">Unmount filesystem</a></h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fusermount -u &lt;mount_point&gt;
</code></pre></div><p>If you used <a href="#aws_s3_using_systemd">systemd</a> to mount a bucket:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl stop s3fs.service
sudo systemctl disable s3fs.service
</code></pre></div><h2 id="microsoft-azure-container-as-filesystem">Microsoft Azure container as filesystem</h2>
<h3 id="a-nameazure_ubuntu_2004ubuntu-2004a"><a name="azure_ubuntu_2004">Ubuntu 20.04</a></h3>
<h4 id="a-nameazure_mountmounta"><a name="azure_mount">Mount</a></h4>
<ol>
<li>
<p>Set up the Microsoft package repository.(More <a href="https://docs.microsoft.com/en-us/windows-server/administration/Linux-Package-Repository-for-Microsoft-Software#configuring-the-repositories">here</a>)</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb
sudo dpkg -i packages-microsoft-prod.deb
sudo apt-get update
</code></pre></div></li>
<li>
<p>Install <code>blobfuse</code> and <code>fuse</code>:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install blobfuse fuse
</code></pre></div><p>For more details see <a href="https://github.com/Azure/azure-storage-fuse/wiki/1.-Installation">here</a></p>
</li>
<li>
<p>Create environments (replace <code>account_name</code>, <code>account_key</code>, <code>mount_point</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">AZURE_STORAGE_ACCOUNT</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;account_name&gt;
<span style="color:#204a87">export</span> <span style="color:#000">AZURE_STORAGE_ACCESS_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;account_key&gt;
<span style="color:#000">MOUNT_POINT</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;mount_point&gt;
</code></pre></div></li>
<li>
<p>Create a folder for cache:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mkdir -p /mnt/blobfusetmp
</code></pre></div></li>
<li>
<p>Make sure the file must be owned by the user who mounts the container:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chown &lt;user&gt; /mnt/blobfusetmp
</code></pre></div></li>
<li>
<p>Create the mount point, if it doesn&rsquo;t exists:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span>
</code></pre></div></li>
<li>
<p>Uncomment <code>user_allow_other</code> in the <code>/etc/fuse.conf</code> file: <code>sudo nano /etc/fuse.conf</code></p>
</li>
<li>
<p>Mount container(replace <code>your_container</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">blobfuse <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span> --container-name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;your_container&gt; --tmp-path<span style="color:#ce5c00;font-weight:bold">=</span>/mnt/blobfusetmp -o allow_other
</code></pre></div></li>
</ol>
<h4 id="a-nameazure_automatically_mountautomatically-mounta"><a name="azure_automatically_mount">Automatically mount</a></h4>
<p>Follow the first 7 mounting steps above.</p>
<h5 id="a-nameazure_using_fstabusing-fstaba"><a name="azure_using_fstab">Using fstab</a></h5>
<ol>
<li>
<p>Create configuration file <code>connection.cfg</code> with same content, change accountName,
select one from accountKey or sasToken and replace with your value:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">accountName &lt;account-name-here&gt;
<span style="color:#8f5902;font-style:italic"># Please provide either an account key or a SAS token, and delete the other line.</span>
accountKey &lt;account-key-here-delete-next-line&gt;
<span style="color:#8f5902;font-style:italic">#change authType to specify only 1</span>
sasToken &lt;shared-access-token-here-delete-previous-line&gt;
authType &lt;MSI/SAS/SPN/Key/empty&gt;
containerName &lt;insert-container-name-here&gt;
</code></pre></div></li>
<li>
<p>Create a bash script named <code>azure_fuse</code>(e.g in /usr/bin, as root) with content below
(replace <code>user_name</code> on whose behalf the disk will be mounted, <code>mount_point</code>, <code>/path/to/blobfusetmp</code>,<code>/path/to/connection.cfg</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span><span style="color:#8f5902;font-style:italic"></span>sudo -u &lt;user_name&gt; blobfuse &lt;mount_point&gt; --tmp-path<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/blobfusetmp  --config-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/connection.cfg -o allow_other
<span style="color:#204a87">exit</span> <span style="color:#0000cf;font-weight:bold">0</span>
</code></pre></div></li>
<li>
<p>Give it the execution permission:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chmod +x /usr/bin/azure_fuse
</code></pre></div></li>
<li>
<p>Edit <code>/etc/fstab</code> with the blobfuse script. Add the following line(replace paths):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/absolute/path/to/azure_fuse &lt;/path/to/desired/mountpoint&gt; fuse allow_other,user,_netdev
</code></pre></div></li>
</ol>
<h5 id="a-nameazure_using_systemdusing-systemda"><a name="azure_using_systemd">Using systemd</a></h5>
<ol>
<li>
<p>Create unit file <code>sudo nano /etc/systemd/system/blobfuse.service</code>.
(replace <code>user_name</code>, <code>mount_point</code>, <code>container_name</code>,<code>/path/to/connection.cfg</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>Unit<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span>FUSE filesystem over Azure container
<span style="color:#000">After</span><span style="color:#ce5c00;font-weight:bold">=</span>network.target

<span style="color:#ce5c00;font-weight:bold">[</span>Service<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Environment</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;MOUNT_POINT=&lt;mount_point&gt;&#34;</span>
<span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">Group</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>blobfuse <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span> --container-name<span style="color:#ce5c00;font-weight:bold">=</span>&lt;container_name&gt; --tmp-path<span style="color:#ce5c00;font-weight:bold">=</span>/mnt/blobfusetmp --config-file<span style="color:#ce5c00;font-weight:bold">=</span>/path/to/connection.cfg -o allow_other
<span style="color:#000">ExecStop</span><span style="color:#ce5c00;font-weight:bold">=</span>fusermount -u <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span>
<span style="color:#000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span>always
<span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>forking

<span style="color:#ce5c00;font-weight:bold">[</span>Install<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span>multi-user.target
</code></pre></div></li>
<li>
<p>Update the system configurations, enable unit autorun when the system boots, mount the container:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl daemon-reload
sudo systemctl <span style="color:#204a87">enable</span> blobfuse.service
sudo systemctl start blobfuse.service
</code></pre></div><p>Or for more detail <a href="https://github.com/Azure/azure-storage-fuse/tree/master/systemd">see here</a></p>
</li>
</ol>
<h4 id="a-nameazure_checkchecka"><a name="azure_check">Check</a></h4>
<p>A file <code>/etc/mtab</code> contains records of currently mounted filesystems.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /etc/mtab <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;blobfuse&#39;</span>
</code></pre></div><h4 id="a-nameazure_unmount_filesystemunmount-filesystema"><a name="azure_unmount_filesystem">Unmount filesystem</a></h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fusermount -u &lt;mount_point&gt;
</code></pre></div><p>If you used <a href="#azure_using_systemd">systemd</a> to mount a container:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl stop blobfuse.service
sudo systemctl disable blobfuse.service
</code></pre></div><p>If you have any mounting problems, check out the <a href="https://github.com/Azure/azure-storage-fuse/wiki/3.-Troubleshoot-FAQ">answers</a>
to common problems</p>
<h2 id="google-drive-as-filesystem">Google Drive as filesystem</h2>
<h3 id="a-namegoogle_drive_ubuntu_2004ubuntu-2004a"><a name="google_drive_ubuntu_2004">Ubuntu 20.04</a></h3>
<h4 id="a-namegoogle_drive_mountmounta"><a name="google_drive_mount">Mount</a></h4>
<p>To mount a google drive as a filesystem in user space(FUSE)
you can use <a href="https://github.com/astrada/google-drive-ocamlfuse">google-drive-ocamlfuse</a>
To do this follow the instructions below:</p>
<ol>
<li>
<p>Install google-drive-ocamlfuse:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo add-apt-repository ppa:alessandro-strada/ppa
sudo apt-get update
sudo apt-get install google-drive-ocamlfuse
</code></pre></div></li>
<li>
<p>Run <code>google-drive-ocamlfuse</code> without parameters:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">google-drive-ocamlfuse
</code></pre></div><p>This command will create the default application directory (~/.gdfuse/default),
containing the configuration file config (see the <a href="https://github.com/astrada/google-drive-ocamlfuse/wiki">wiki</a>
page for more details about configuration).
And it will start a web browser to obtain authorization to access your Google Drive.
This will let you modify default configuration before mounting the filesystem.</p>
<p>Then you can choose a local directory to mount your Google Drive (e.g.: ~/GoogleDrive).</p>
</li>
<li>
<p>Create the mount point, if it doesn&rsquo;t exist(replace mount_point):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">mountpoint</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&lt;mount_point&gt;&#34;</span>
mkdir -p <span style="color:#000">$mountpoint</span>
</code></pre></div></li>
<li>
<p>Uncomment <code>user_allow_other</code> in the <code>/etc/fuse.conf</code> file: <code>sudo nano /etc/fuse.conf</code></p>
</li>
<li>
<p>Mount the filesystem:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">google-drive-ocamlfuse -o allow_other <span style="color:#000">$mountpoint</span>
</code></pre></div></li>
</ol>
<h4 id="a-namegoogle_drive_automatically_mountautomatically-mounta"><a name="google_drive_automatically_mount">Automatically mount</a></h4>
<p>Follow the first 4 mounting steps above.</p>
<h5 id="a-namegoogle_drive_using_fstabusing-fstaba"><a name="google_drive_using_fstab">Using fstab</a></h5>
<ol>
<li>
<p>Create a bash script named gdfuse(e.g in /usr/bin, as root) with this content
(replace <code>user_name</code> on whose behalf the disk will be mounted, <code>label</code>, <code>mount_point</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic">#!/bin/bash
</span><span style="color:#8f5902;font-style:italic"></span>sudo -u &lt;user_name&gt; google-drive-ocamlfuse -o allow_other -label &lt;label&gt; &lt;mount_point&gt;
<span style="color:#204a87">exit</span> <span style="color:#0000cf;font-weight:bold">0</span>
</code></pre></div></li>
<li>
<p>Give it the execution permission:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo chmod +x /usr/bin/gdfuse
</code></pre></div></li>
<li>
<p>Edit <code>/etc/fstab</code> adding a line like this, replace <code>mount_point</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/absolute/path/to/gdfuse  &lt;mount_point&gt;     fuse    allow_other,user,_netdev     <span style="color:#0000cf;font-weight:bold">0</span>       <span style="color:#0000cf;font-weight:bold">0</span>
</code></pre></div><p>For more details see <a href="https://github.com/astrada/google-drive-ocamlfuse/wiki/Automounting">here</a></p>
</li>
</ol>
<h5 id="a-namegoogle_drive_using_systemdusing-systemda"><a name="google_drive_using_systemd">Using systemd</a></h5>
<ol>
<li>
<p>Create unit file <code>sudo nano /etc/systemd/system/google-drive-ocamlfuse.service</code>.
(replace <code>user_name</code>, <code>label</code>(default <code>label=default</code>), <code>mount_point</code>):</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ce5c00;font-weight:bold">[</span>Unit<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Description</span><span style="color:#ce5c00;font-weight:bold">=</span>FUSE filesystem over Google Drive
<span style="color:#000">After</span><span style="color:#ce5c00;font-weight:bold">=</span>network.target

<span style="color:#ce5c00;font-weight:bold">[</span>Service<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">Environment</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;MOUNT_POINT=&lt;mount_point&gt;&#34;</span>
<span style="color:#000">User</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">Group</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;user_name&gt;
<span style="color:#000">ExecStart</span><span style="color:#ce5c00;font-weight:bold">=</span>google-drive-ocamlfuse -label &lt;label&gt; <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span>
<span style="color:#000">ExecStop</span><span style="color:#ce5c00;font-weight:bold">=</span>fusermount -u <span style="color:#4e9a06">${</span><span style="color:#000">MOUNT_POINT</span><span style="color:#4e9a06">}</span>
<span style="color:#000">Restart</span><span style="color:#ce5c00;font-weight:bold">=</span>always
<span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>forking

<span style="color:#ce5c00;font-weight:bold">[</span>Install<span style="color:#ce5c00;font-weight:bold">]</span>
<span style="color:#000">WantedBy</span><span style="color:#ce5c00;font-weight:bold">=</span>multi-user.target
</code></pre></div></li>
<li>
<p>Update the system configurations, enable unit autorun when the system boots, mount the drive:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl daemon-reload
sudo systemctl <span style="color:#204a87">enable</span> google-drive-ocamlfuse.service
sudo systemctl start google-drive-ocamlfuse.service
</code></pre></div><p>For more details see <a href="https://github.com/astrada/google-drive-ocamlfuse/wiki/Automounting">here</a></p>
</li>
</ol>
<h4 id="a-namegoogle_drive_checkchecka"><a name="google_drive_check">Check</a></h4>
<p>A file <code>/etc/mtab</code> contains records of currently mounted filesystems.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat /etc/mtab <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;google-drive-ocamlfuse&#39;</span>
</code></pre></div><h4 id="a-namegoogle_drive_unmount_filesystemunmount-filesystema"><a name="google_drive_unmount_filesystem">Unmount filesystem</a></h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">fusermount -u &lt;mount_point&gt;
</code></pre></div><p>If you used <a href="#google_drive_using_systemd">systemd</a> to mount a drive:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo systemctl stop google-drive-ocamlfuse.service
sudo systemctl disable google-drive-ocamlfuse.service
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-bc00cbca4716757ea2a98e7e6cd0e24c">5 - LDAP Backed Authentication</h1>
    <div class="lead">Allow users to login with credentials from a central source</div>
	<h3 id="the-creation-of-settingspy">The creation of <code>settings.py</code></h3>
<p>When integrating LDAP login, we need to create an overlay to the default CVAT
settings located in
<a href="https://github.com/cvat-ai/cvat/blob/develop/cvat/settings/production.py">cvat/settings/production.py</a>.
This overlay is where we will configure Django to connect to the LDAP server.</p>
<p>The main issue with using LDAP is that different LDAP implementations have
different parameters. So the options used for Active Directory backed
authentication will differ if you were to be using FreeIPA.</p>
<h3 id="update-docker-composeoverrideyml">Update <code>docker-compose.override.yml</code></h3>
<p>In your override config you need to passthrough your settings and tell CVAT to
use them by setting the <code>DJANGO_SETTINGS_MODULE</code> variable.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#204a87;font-weight:bold">services</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cvat_server</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">environment</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">DJANGO_SETTINGS_MODULE</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">settings</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">volumes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">./settings.py:/home/django/settings.py:ro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="active-directory-example">Active Directory Example</h3>
<p>The following example should allow for users to authenticate themselves against
Active Directory. This example requires a dummy user named <code>cvat_bind</code>. The
configuration for the bind account does not need any special permissions.</p>
<p>When updating <code>AUTH_LDAP_BIND_DN</code>, you can write out the account info in two
ways. Both are documented in the config below.</p>
<p>This config is known to work with Windows Server 2022, but should work for older
versions and Samba&rsquo;s implementation of Active Directory.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#8f5902;font-style:italic"># We are overlaying production</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cvat.settings.production</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#8f5902;font-style:italic"># Custom code below</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ldap</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_auth_ldap.config</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LDAPSearch</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_auth_ldap.config</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">NestedActiveDirectoryGroupType</span>

<span style="color:#8f5902;font-style:italic"># Notify CVAT that we are using LDAP authentication</span>
<span style="color:#000">IAM_TYPE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;LDAP&#39;</span>

<span style="color:#8f5902;font-style:italic"># Talking to the LDAP server</span>
<span style="color:#000">AUTH_LDAP_SERVER_URI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;ldap://ad.example.com&#34;</span> <span style="color:#8f5902;font-style:italic"># IP Addresses also work</span>
<span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_option</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">OPT_REFERRALS</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">_BASE_DN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;CN=Users,DC=ad,DC=example,DC=com&#34;</span>

<span style="color:#8f5902;font-style:italic"># Authenticating with the LDAP server</span>
<span style="color:#000">AUTH_LDAP_BIND_DN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;CN=cvat_bind,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span>
<span style="color:#8f5902;font-style:italic"># AUTH_LDAP_BIND_DN = &#34;cvat_bind@ad.example.com&#34;</span>
<span style="color:#000">AUTH_LDAP_BIND_PASSWORD</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;SuperSecurePassword^21&#34;</span>

<span style="color:#000">AUTH_LDAP_USER_SEARCH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LDAPSearch</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SCOPE_SUBTREE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;(sAMAccountName=</span><span style="color:#4e9a06">%(user)s</span><span style="color:#4e9a06">)&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">AUTH_LDAP_GROUP_SEARCH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LDAPSearch</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SCOPE_SUBTREE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;(objectClass=group)&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Mapping Django field names to Active Directory attributes</span>
<span style="color:#000">AUTH_LDAP_USER_ATTR_MAP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;user_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;sAMAccountName&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;sn&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;mail&#34;</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#8f5902;font-style:italic"># Group Management</span>
<span style="color:#000">AUTH_LDAP_GROUP_TYPE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">NestedActiveDirectoryGroupType</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># Register Django LDAP backend</span>
<span style="color:#000">AUTHENTICATION_BACKENDS</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;django_auth_ldap.backend.LDAPBackend&#39;</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#8f5902;font-style:italic"># Map Active Directory groups to Django/CVAT groups.</span>
<span style="color:#000">AUTH_LDAP_ADMIN_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=CVAT Admins,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_BUSINESS_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=CVAT Managers,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_WORKER_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=CVAT Workers,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_USER_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=CVAT Users,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>

<span style="color:#000">DJANGO_AUTH_LDAP_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_ADMIN_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;business&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_BUSINESS_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_USER_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;worker&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_WORKER_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="freeipa-example">FreeIPA Example</h3>
<p>The following example should allow for users to authenticate themselves against
FreeIPA. This example requires a dummy user named <code>cvat_bind</code>. The configuration
for the bind account does not need any special permissions.</p>
<p>When updating <code>AUTH_LDAP_BIND_DN</code>, you can only write the user info in one way,
unlike with <a href="#active-directory-example">Active Directory</a></p>
<p>This config is known to work with AlmaLinux 8, but may work for other
versions and flavors of Enterprise Linux.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#8f5902;font-style:italic"># We are overlaying production</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">cvat.settings.production</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#ce5c00;font-weight:bold">*</span>

<span style="color:#8f5902;font-style:italic"># Custom code below</span>
<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ldap</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_auth_ldap.config</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">LDAPSearch</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">django_auth_ldap.config</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">GroupOfNamesType</span>

<span style="color:#8f5902;font-style:italic"># Notify CVAT that we are using LDAP authentication</span>
<span style="color:#000">IAM_TYPE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;LDAP&#39;</span>

<span style="color:#000">_BASE_DN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;CN=Accounts,DC=ipa,DC=example,DC=com&#34;</span>

<span style="color:#8f5902;font-style:italic"># Talking to the LDAP server</span>
<span style="color:#000">AUTH_LDAP_SERVER_URI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;ldap://ipa.example.com&#34;</span> <span style="color:#8f5902;font-style:italic"># IP Addresses also work</span>
<span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">set_option</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">OPT_REFERRALS</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Authenticating with the LDAP server</span>
<span style="color:#000">AUTH_LDAP_BIND_DN</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;UID=cvat_bind,CN=Users,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span>
<span style="color:#000">AUTH_LDAP_BIND_PASSWORD</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;SuperSecurePassword^21&#34;</span>

<span style="color:#000">AUTH_LDAP_USER_SEARCH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LDAPSearch</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#4e9a06">&#34;CN=Users,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SCOPE_SUBTREE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;(uid=</span><span style="color:#4e9a06">%(user)s</span><span style="color:#4e9a06">)&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#000">AUTH_LDAP_GROUP_SEARCH</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">LDAPSearch</span><span style="color:#000;font-weight:bold">(</span>
    <span style="color:#4e9a06">&#34;CN=Groups,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#34;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#000">ldap</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">SCOPE_SUBTREE</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;(objectClass=groupOfNames)&#34;</span>
<span style="color:#000;font-weight:bold">)</span>

<span style="color:#8f5902;font-style:italic"># Mapping Django field names to FreeIPA attributes</span>
<span style="color:#000">AUTH_LDAP_USER_ATTR_MAP</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;user_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;uid&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;givenName&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;sn&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;email&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;mail&#34;</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#8f5902;font-style:italic"># Group Management</span>
<span style="color:#000">AUTH_LDAP_GROUP_TYPE</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">GroupOfNamesType</span><span style="color:#000;font-weight:bold">()</span>

<span style="color:#8f5902;font-style:italic"># Register Django LDAP backend</span>
<span style="color:#000">AUTHENTICATION_BACKENDS</span> <span style="color:#ce5c00;font-weight:bold">+=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#39;django_auth_ldap.backend.LDAPBackend&#39;</span><span style="color:#000;font-weight:bold">]</span>

<span style="color:#8f5902;font-style:italic"># Map FreeIPA groups to Django/CVAT groups.</span>
<span style="color:#000">AUTH_LDAP_ADMIN_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=cvat_admins,CN=Groups,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_BUSINESS_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=cvat_managers,CN=Groups,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_WORKER_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=cvat_workers,CN=Groups,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>
<span style="color:#000">AUTH_LDAP_USER_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
    <span style="color:#4e9a06">&#39;CN=cvat_users,CN=Groups,</span><span style="color:#4e9a06">%s</span><span style="color:#4e9a06">&#39;</span> <span style="color:#ce5c00;font-weight:bold">%</span> <span style="color:#000">_BASE_DN</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">]</span>

<span style="color:#000">DJANGO_AUTH_LDAP_GROUPS</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;admin&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_ADMIN_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;business&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_BUSINESS_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;user&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_USER_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;worker&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">AUTH_LDAP_WORKER_GROUPS</span><span style="color:#000;font-weight:bold">,</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="resources">Resources</h3>
<ul>
<li><a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/ldap/distinguished-names">Microsoft - LDAP Distinguished Names</a>
<ul>
<li>Elements that make up a distinguished name. Used with user/group searches.</li>
</ul>
</li>
<li><a href="https://django-auth-ldap.readthedocs.io/en/latest/reference.html">Django LDAP Reference Manual</a>
<ul>
<li>Other options that can be used for LDAP authentication in Django.</li>
</ul>
</li>
<li><a href="https://techexpert.tips/django/django-ldap-authentication-active-directory">Django LDAP guide using Active Directory (Unofficial)</a>
<ul>
<li>This is not specific to CVAT but can provide insight about firewall rules.</li>
</ul>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c7cf871a1ff98f3a84b27456c266df2c">6 - Backup guide</h1>
    <div class="lead">Instructions on how to backup CVAT data with Docker.</div>
	<!--lint disable heading-style-->
<h2 id="about-cvat-data-volumes">About CVAT data volumes</h2>
<p>Docker volumes are used to store all CVAT data:</p>
<ul>
<li>
<p><code>cvat_db</code>: PostgreSQL database files, used to store information about users, tasks, projects, annotations, etc.
Mounted into <code>cvat_db</code> container by <code>/var/lib/postgresql/data</code> path.</p>
</li>
<li>
<p><code>cvat_data</code>: used to store uploaded and prepared media data.
Mounted into <code>cvat</code> container by <code>/home/django/data</code> path.</p>
</li>
<li>
<p><code>cvat_keys</code>: used to store the <a href="https://docs.djangoproject.com/en/4.2/ref/settings/#std-setting-SECRET_KEY">Django secret key</a>.
Mounted into <code>cvat</code> container by <code>/home/django/keys</code> path.</p>
</li>
<li>
<p><code>cvat_logs</code>: used to store logs of CVAT backend processes managed by supevisord.
Mounted into <code>cvat</code> container by <code>/home/django/logs</code> path.</p>
</li>
<li>
<p><code>cvat_events</code>: this is an optional volume that is used only when <a href="../../../../docs/administration/advanced/analytics/">Analytics component</a>
is enabled and is used to store Elasticsearch database files.
Mounted into <code>cvat_elasticsearch</code> container by <code>/usr/share/elasticsearch/data</code> path.</p>
</li>
</ul>
<h2 id="how-to-backup-all-cvat-data">How to backup all CVAT data</h2>
<p>All CVAT containers should be stopped before backup:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose stop
</code></pre></div><p>Please don&rsquo;t forget to include all the compose config files that were used in the <code>docker compose</code> command
using the <code>-f</code> parameter.</p>
<p>Backup data:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir backup
docker run --rm --name temp_backup --volumes-from cvat_db -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/backup:/backup ubuntu tar -czvf /backup/cvat_db.tar.gz /var/lib/postgresql/data
docker run --rm --name temp_backup --volumes-from cvat_server -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/backup:/backup ubuntu tar -czvf /backup/cvat_data.tar.gz /home/django/data
<span style="color:#8f5902;font-style:italic"># [optional]</span>
docker run --rm --name temp_backup --volumes-from cvat_elasticsearch -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>/backup:/backup ubuntu tar -czvf /backup/cvat_events.tar.gz /usr/share/elasticsearch/data
</code></pre></div><p>Make sure the backup archives have been created, the output of <code>ls backup</code> command should look like this:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ls backup
cvat_data.tar.gz  cvat_db.tar.gz  cvat_events.tar.gz
</code></pre></div><h2 id="how-to-restore-cvat-from-backup">How to restore CVAT from backup</h2>
<p><strong>Warning: use exactly the same CVAT version to restore DB. Otherwise
it will not work because between CVAT releases the layout of DB can be
changed. You always can upgrade CVAT later. It will take care to migrate
your data properly internally.</strong></p>
<p>Note: CVAT containers must exist (if no, please follow the <a href="../../../../docs/administration/basics/installation/#quick-installation-guide">installation guide</a>).
Stop all CVAT containers:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose stop
</code></pre></div><p>Restore data:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#204a87">cd</span> &lt;path_to_backup_folder&gt;
docker run --rm --name temp_backup --volumes-from cvat_db -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>:/backup ubuntu bash -c <span style="color:#4e9a06">&#34;cd /var/lib/postgresql/data &amp;&amp; tar -xvf /backup/cvat_db.tar.gz --strip 4&#34;</span>
docker run --rm --name temp_backup --volumes-from cvat_server -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>:/backup ubuntu bash -c <span style="color:#4e9a06">&#34;cd /home/django/data &amp;&amp; tar -xvf /backup/cvat_data.tar.gz --strip 3&#34;</span>
<span style="color:#8f5902;font-style:italic"># [optional]</span>
docker run --rm --name temp_backup --volumes-from cvat_elasticsearch -v <span style="color:#204a87;font-weight:bold">$(</span><span style="color:#204a87">pwd</span><span style="color:#204a87;font-weight:bold">)</span>:/backup ubuntu bash -c <span style="color:#4e9a06">&#34;cd /usr/share/elasticsearch/data &amp;&amp; tar -xvf /backup/cvat_events.tar.gz --strip 4&#34;</span>
</code></pre></div><p>After that run CVAT as usual:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose up -d
</code></pre></div><h2 id="additional-resources">Additional resources</h2>
<p><a href="https://docs.docker.com/storage/volumes/#backup-restore-or-migrate-data-volumes">Docker guide about volume backups</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-da6bd132cb59bd11a7d23d7656ddb37f">7 - Upgrade guide</h1>
    <div class="lead">Instructions for upgrading CVAT deployed with docker compose</div>
	<!--lint disable heading-style-->
<h2 id="upgrade-guide">Upgrade guide</h2>
<p>Note: updating CVAT from version 2.2.0 to version 2.3.0 requires additional manual actions with database data due to
upgrading PostgreSQL base image major version. See details <a href="#how-to-upgrade-postgresql-database-base-image">here</a></p>
<p>To upgrade CVAT, follow these steps:</p>
<ul>
<li>
<p>It is highly recommended backup all CVAT data before updating, follow the
<a href="../../../../docs/administration/advanced/backup_guide/">backup guide</a> and backup all CVAT volumes.</p>
</li>
<li>
<p>Go to the previously cloned CVAT directory and stop all CVAT containers with:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose down
</code></pre></div><p>If you have included <a href="../../../../docs/administration/basics/installation/#additional-components">additional components</a>,
include all compose configuration files that are used, e.g.:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose -f docker-compose.yml -f components/serverless/docker-compose.serverless.yml down
</code></pre></div></li>
<li>
<p>Update CVAT source code by any preferable way: clone with git or download zip file from GitHub.
Note that you need to download the entire source code, not just the Docker Compose configuration file.
Check the
<a href="../../../../docs/administration/basics/installation/#how-to-get-cvat-source-code">installation guide</a> for details.</p>
</li>
<li>
<p>Verify settings:
The installation process is changed/modified from version to version and
you may need to export some environment variables, for example
<a href="../../../../docs/administration/basics/installation/#use-your-own-domain">CVAT_HOST</a>.</p>
</li>
<li>
<p>Update local CVAT images.
Pull or build new CVAT images, see
<a href="../../../../docs/administration/basics/installation/#how-to-pullbuildupdate-cvat-images">How to pull/build/update CVAT images section</a>
for details.</p>
</li>
<li>
<p>Start CVAT with:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose up -d
</code></pre></div><p>When CVAT starts, it will upgrade its DB in accordance with the latest schema.
It can take time especially if you have a lot of data.
Please do not terminate the migration and wait till the process is complete.
You can monitor the startup process with the following command:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker logs cvat_server -f
</code></pre></div></li>
</ul>
<h2 id="how-to-upgrade-cvat-from-v220-to-v230">How to upgrade CVAT from v2.2.0 to v2.3.0.</h2>
<p>Step by step commands how to upgrade CVAT from v2.2.0 to v2.3.0.
Let&rsquo;s assume that you have CVAT v2.2.0 working.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker <span style="color:#204a87">exec</span> -it cvat_db pg_dumpall &gt; cvat.db.dump
<span style="color:#204a87">cd</span> cvat
docker compose down
docker volume rm cvat_cvat_db
<span style="color:#204a87">export</span> <span style="color:#000">CVAT_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;v2.3.0&#34;</span>
<span style="color:#204a87">cd</span> ..
mv cvat cvat_220
wget https://github.com/opencv/cvat/archive/refs/tags/<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>.zip
unzip <span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>.zip <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> mv cvat-<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">1</span><span style="color:#4e9a06">}</span> cvat
<span style="color:#204a87">unset</span> CVAT_VERSION
<span style="color:#204a87">cd</span> cvat
<span style="color:#204a87">export</span> <span style="color:#000">CVAT_HOST</span><span style="color:#ce5c00;font-weight:bold">=</span>cvat.example.com
<span style="color:#204a87">export</span> <span style="color:#000">ACME_EMAIL</span><span style="color:#ce5c00;font-weight:bold">=</span>example@example.com
docker compose pull
docker compose up -d cvat_db
docker <span style="color:#204a87">exec</span> -i cvat_db psql -q -d postgres &lt; ../cvat.db.dump
docker compose -f docker-compose.yml -f docker-compose.dev.yml -f docker-compose.https.yml up -d
</code></pre></div><h2 id="how-to-upgrade-cvat-from-v170-to-v220">How to upgrade CVAT from v1.7.0 to v2.2.0.</h2>
<p>Step by step commands how to upgrade CVAT from v1.7.0 to v2.2.0.
Let&rsquo;s assume that you have CVAT v1.7.0 working.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#204a87">export</span> <span style="color:#000">CVAT_VERSION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;v2.2.0&#34;</span>
<span style="color:#204a87">cd</span> cvat
docker compose down
<span style="color:#204a87">cd</span> ..
mv cvat cvat_170
wget https://github.com/opencv/cvat/archive/refs/tags/<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>.zip
unzip <span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>.zip <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> mv cvat-<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#000;font-weight:bold">:</span><span style="color:#000">1</span><span style="color:#4e9a06">}</span> cvat
<span style="color:#204a87">cd</span> cvat
docker pull cvat/server:<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>
docker tag cvat/server:<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span> openvino/cvat_server:latest
docker pull cvat/ui:<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span>
docker tag cvat/ui:<span style="color:#4e9a06">${</span><span style="color:#000">CVAT_VERSION</span><span style="color:#4e9a06">}</span> openvino/cvat_ui:latest
docker compose up -d
</code></pre></div><h2 id="how-to-upgrade-postgresql-database-base-image">How to upgrade PostgreSQL database base image</h2>
<ol>
<li>
<p>It is highly recommended backup all CVAT data before updating, follow the
<a href="../../../../docs/administration/advanced/backup_guide/">backup guide</a> and backup CVAT database volume.</p>
</li>
<li>
<p>Run previously used CVAT version as usual</p>
</li>
<li>
<p>Backup current database with <code>pg_dumpall</code> tool:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker <span style="color:#204a87">exec</span> -it cvat_db pg_dumpall &gt; cvat.db.dump
</code></pre></div></li>
<li>
<p>Stop CVAT:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose down
</code></pre></div></li>
<li>
<p>Delete current PostgreSQL’s volume, that&rsquo;s why it&rsquo;s important to have a backup:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker volume rm cvat_cvat_db
</code></pre></div></li>
<li>
<p>Update CVAT source code by any preferable way: clone with git or download zip file from GitHub.
Check the
<a href="../../../../docs/administration/basics/installation/#how-to-get-cvat-source-code">installation guide</a> for details.</p>
</li>
<li>
<p>Start database container only:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose up -d cvat_db
</code></pre></div></li>
<li>
<p>Import PostgreSQL dump into new DB container:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker <span style="color:#204a87">exec</span> -i cvat_db psql -q -d postgres &lt; cvat.db.dump
</code></pre></div></li>
<li>
<p>Start CVAT:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">docker compose up -d
</code></pre></div></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4f8e6a0deaea3f18579f18b2ee20ccd0">8 - IAM: system roles</h1>
    
	<!--lint disable heading-style-->
<h2 id="system-roles">System roles</h2>
<p>By default CVAT users can be assigned to one of the following groups: <code>admin</code>, <code>business</code>, <code>user</code> and <code>worker</code>.</p>
<p>Each of these groups gives a set of permissions.
TBD</p>
<h2 id="changing-permissions">Changing permissions</h2>
<p>System permissions are defined using <code>.rego</code> files stored in <code>cvat/apps/iam/rules/</code>.
Rego is a declarative language used for defining OPA policies.
It&rsquo;s syntax is defined in <a href="https://www.openpolicyagent.org/docs/latest/policy-language/">OPA docs</a>.</p>
<p>After changing the <code>.rego</code> files, you need to rebuilt and restart the docker compose for the changes to take effect.
In this case you need to include <code>docker-compose.dev.yml</code> compose config file to <code>docker compose</code> command.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8c9745042bfb600d029dd86b05b8630e">9 - Webhooks</h1>
    <div class="lead">CVAT Webhooks: set up and use</div>
	<p>Webhooks are user-defined HTTP callbacks that are triggered by specific events.
When an event that triggers a webhook occurs, CVAT makes an HTTP request
to the URL configured for the webhook.
The request will include a payload with information about the event.</p>
<p>CVAT, webhooks can be triggered by a variety of events,
such as the creation, deletion, or modification of tasks,
jobs, and so on.
This makes it easy to set up automated processes
that respond to changes made in CVAT.</p>
<p>For example, you can set up webhooks to alert you when a job&rsquo;s assignee is changed or when
a job/task&rsquo;s status is updated, for instance, when a job is completed and ready for review
or has been reviewed. New task creation can also trigger notifications.</p>
<p>These capabilities allow you to keep track of progress and changes in your CVAT workflow instantly.</p>
<p>In CVAT you can create a webhook for a project or organization.
You can use CVAT GUI or direct API calls.</p>
<p>See:</p>
<ul>
<li><a href="#create-webhook">Create Webhook</a>
<ul>
<li><a href="#for-project">For project</a></li>
<li><a href="#for-organization">For organization</a></li>
<li><a href="#webhooks-forms">Webhooks forms</a></li>
<li><a href="#list-of-events">List of events</a></li>
</ul>
</li>
<li><a href="#payloads">Payloads</a>
<ul>
<li><a href="#create-event">Create event</a></li>
<li><a href="#update-event">Update event</a></li>
<li><a href="#delete-event">Delete event</a></li>
</ul>
</li>
<li><a href="#webhook-secret">Webhook secret</a></li>
<li><a href="#ping-webhook">Ping Webhook</a></li>
<li><a href="#webhooks-with-api-calls">Webhooks with API calls</a></li>
<li><a href="#example-of-setup-and-use">Example of setup and use</a></li>
</ul>
<h2 id="create-webhook">Create Webhook</h2>
<h3 id="for-project">For project</h3>
<p>To create a webhook for <strong>Project</strong>, do the following:</p>
<ol>
<li>
<p><a href="../../../../docs/manual/advanced/projects/">Create a Project</a>.</p>
</li>
<li>
<p>Go to the <strong>Projects</strong> and click on the project&rsquo;s widget.</p>
</li>
<li>
<p>In the top right corner, click <strong>Actions</strong> &gt; <strong>Setup Webhooks</strong>.</p>
</li>
<li>
<p>In the top right corner click <strong>+</strong></p>
<p><img src="../../../../images/create_project_webhook.gif" alt="Create Project Webhook"></p>
</li>
<li>
<p>Fill in the <strong><a href="#webhooks-forms">Setup webhook</a></strong> form and click <strong>Submit</strong>.</p>
</li>
</ol>
<h3 id="for-organization">For organization</h3>
<p>To create a webhook for <strong>Organization</strong>, do the following:</p>
<ol>
<li><a href="../../../../docs/manual/advanced/organization/">Create Organization</a></li>
<li>Go to the <strong>Organization</strong> &gt; <strong>Settings</strong> &gt; <strong>Actions</strong> &gt; <strong>Setup Webhooks</strong>.</li>
<li>In the top right corner click <strong>+</strong></li>
</ol>
<p><img src="../../../../images/create_organization_webhook.gif" alt=""></p>
<ol start="4">
<li>Fill in the <strong><a href="#webhooks-forms">Setup webhook</a></strong> form and click <strong>Submit</strong>.</li>
</ol>
<h3 id="webhooks-forms">Webhooks forms</h3>
<p>The <strong>Setup a webhook</strong> forms look like the following.</p>
<p><img src="../../../../images/webhook_form_project_org.jpg" alt="Create Project And Org Webhook Forms "></p>
<p>Forms have the following fields:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Target URL</td>
<td>The URL where the event data will be sent.</td>
</tr>
<tr>
<td>Description</td>
<td>Provides a brief summary of the webhook&rsquo;s purpose.</td>
</tr>
<tr>
<td>Project</td>
<td>A drop-down list that lets you select from available projects.</td>
</tr>
<tr>
<td>Content type</td>
<td>Defines the data type for the payload in the webhook request via the HTTP Content-Type field.</td>
</tr>
<tr>
<td>Secret</td>
<td>A unique key for verifying the webhook&rsquo;s origin, ensuring it&rsquo;s genuinely from CVAT. <br>For more information, see <a href="#webhook-secret">Webhook secret</a></td>
</tr>
<tr>
<td>Enable SSL</td>
<td>A checkbox for enabling or disabling <a href="https://en.wikipedia.org/wiki/Public_key_certificate">SSL verification</a>.</td>
</tr>
<tr>
<td>Active</td>
<td>Uncheck this box if you want to stop the delivery of specific webhook payloads.</td>
</tr>
<tr>
<td>Send everything</td>
<td>Check this box to send all event types through the webhook.</td>
</tr>
<tr>
<td>Specify individual events</td>
<td>Choose this option to send only certain event types. <br>Refer to the <a href="#list-of-available-events">List of available events</a> for more information on event types.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<h3 id="list-of-events">List of events</h3>
<p>The following events are available for webhook alerts.</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Resource</th>
<th>Create</th>
<th>Update</th>
<th>Delete</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Organization</td>
<td></td>
<td>✅</td>
<td></td>
<td>Alerts for changes made to an Organization.</td>
</tr>
<tr>
<td>Membership</td>
<td></td>
<td>✅</td>
<td>✅</td>
<td>Alerts when a member is added to or removed from an organization.</td>
</tr>
<tr>
<td>Invitation</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td>Alerts when an invitation to an Organization is issued or revoked.</td>
</tr>
<tr>
<td>Project</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Alerts for any actions taken within a project.</td>
</tr>
<tr>
<td>Task</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Alerts for actions related to a task, such as status changes, assignments, etc.</td>
</tr>
<tr>
<td>Job</td>
<td></td>
<td>✅</td>
<td></td>
<td>Alerts for any updates made to a job.</td>
</tr>
<tr>
<td>Issue</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Alerts for any activities involving issues.</td>
</tr>
<tr>
<td>Comment</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>Alerts for actions involving comments, such as creation, deletion, or modification.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<h2 id="payloads">Payloads</h2>
<h3 id="create-event">Create event</h3>
<p>Webhook payload object for <code>create:&lt;resource&gt;</code> events:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event</code></td>
<td><code>string</code></td>
<td>Identifies the event that triggered the webhook, following the <code>create:&lt;resource&gt;</code> pattern.</td>
</tr>
<tr>
<td><code>&lt;resource&gt;</code></td>
<td><code>object</code></td>
<td>Complete information about the created resource. Refer to the <a href="#webhooks-with-api-calls">Swagger</a> docs for individual resource details.</td>
</tr>
<tr>
<td><code>webhook_id</code></td>
<td><code>integer</code></td>
<td>The identifier for the webhook that sends the payload.</td>
</tr>
<tr>
<td><code>sender</code></td>
<td><code>object</code></td>
<td>Details about the user that triggered the webhook.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>An example of payload for the <code>create:task</code> event:</p>
<div class="scroll-code">
  

  
    
  

  
  <div style="overflow-y: auto; max-height: 500px;"><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">
<span style="color:#000;font-weight:bold">{</span>
 <span style="color:#204a87;font-weight:bold">&#34;event&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;create:task&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;task&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/tasks/15&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;task&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;project_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;mode&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;owner&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;assignee&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;bug_tracker&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:50.419259Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;updated_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:50.422917Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;overlap&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;segment_size&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;label_0&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;#bde94a&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;attributes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;any&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;sublabels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;has_parent&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;segments&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
        <span style="color:#204a87;font-weight:bold">&#34;dimension&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2d&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subset&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;organization&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;target_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;source_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;webhook_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;sender&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></div>
</div>
<h3 id="update-event">Update event</h3>
<p>Webhook payload object for <code>update:&lt;resource&gt;</code> events:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event</code></td>
<td><code>string</code></td>
<td>Identifies the event that triggered the webhook, following the <code>update:&lt;resource&gt;</code> pattern.</td>
</tr>
<tr>
<td><code>&lt;resource&gt;</code></td>
<td><code>object</code></td>
<td>Provides complete information about the updated resource. See the Swagger docs for resource details.</td>
</tr>
<tr>
<td><code>before_update</code></td>
<td><code>object</code></td>
<td>Contains keys of <code>&lt;resource&gt;</code> that were updated, along with their old values.</td>
</tr>
<tr>
<td><code>webhook_id</code></td>
<td><code>integer</code></td>
<td>The identifier for the webhook that dispatched the payload.</td>
</tr>
<tr>
<td><code>sender</code></td>
<td><code>object</code></td>
<td>Details about the user that triggered the webhook.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>An example of <code>update:&lt;resource&gt;</code> event:</p>
<div class="scroll-code">
  

  
    
  

  
  <div style="overflow-y: auto; max-height: 500px;"><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">
<span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;event&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;update:task&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;task&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/tasks/15&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;new task name&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;project_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;mode&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;owner&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;assignee&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;bug_tracker&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:50.419259Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;updated_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T11:04:51.451681Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;overlap&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;segment_size&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;label_0&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;#bde94a&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;attributes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;any&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;sublabels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;has_parent&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;segments&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;start_frame&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;stop_frame&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;jobs&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
                    <span style="color:#000;font-weight:bold">{</span>
                        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/jobs/19&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">19</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;assignee&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;stage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
                        <span style="color:#204a87;font-weight:bold">&#34;state&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;new&#34;</span>
                    <span style="color:#000;font-weight:bold">}</span>
                <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">]</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;data_chunk_size&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;data_compressed_chunk_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;imageset&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;data_original_chunk_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;imageset&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;size&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;image_quality&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">70</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;data&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;dimension&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2d&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subset&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;organization&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;target_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;source_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;before_update&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;task&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;webhook_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;sender&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></div>
</div>
<h3 id="delete-event">Delete event</h3>
<p>Webhook payload object for <code>delete:&lt;resource&gt;</code> events:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event</code></td>
<td><code>string</code></td>
<td>Identifies the event that triggered the webhook, following the <code>delete:&lt;resource&gt;</code> pattern.</td>
</tr>
<tr>
<td><code>&lt;resource&gt;</code></td>
<td><code>object</code></td>
<td>Provides complete information about the deleted resource. See the Swagger docs for resource details.</td>
</tr>
<tr>
<td><code>webhook_id</code></td>
<td><code>integer</code></td>
<td>The identifier for the webhook that dispatched the payload.</td>
</tr>
<tr>
<td><code>sender</code></td>
<td><code>object</code></td>
<td>Details about the user that triggered the webhook.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>Here is an example of the payload for the <code>delete:task</code> event:</p>
<div class="scroll-code">
  

  
    
  

  
  <div style="overflow-y: auto; max-height: 500px;"><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">
<span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;event&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;delete:task&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;task&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/tasks/15&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;task&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;project_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;mode&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;owner&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;assignee&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;bug_tracker&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:50.419259Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;updated_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:50.422917Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;overlap&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;segment_size&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;annotation&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;labels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#000;font-weight:bold">{</span>
                <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">28</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;label_0&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;color&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;#bde94a&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;attributes&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;any&#34;</span><span style="color:#000;font-weight:bold">,</span>
                <span style="color:#204a87;font-weight:bold">&#34;sublabels&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
                <span style="color:#204a87;font-weight:bold">&#34;has_parent&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">false</span>
            <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;segments&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[],</span>
        <span style="color:#204a87;font-weight:bold">&#34;dimension&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2d&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;subset&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;organization&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;target_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">14</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;source_storage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">13</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;location&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;local&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;cloud_storage_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span>
        <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;webhook_id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;sender&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></div>
</div>
<h2 id="webhook-secret">Webhook secret</h2>
<p>To validate that the webhook requests originate from CVAT, include a <code>secret</code> during the webhook creation process.</p>
<p>When a <code>secret</code> is provided for the webhook, CVAT includes an <code>X-Signature-256</code> in the request header of the webhook.</p>
<p>CVAT uses the SHA256 hash function to encode the request
body for the webhook and places the resulting hash into the header.</p>
<p>The webhook recipient can verify the source of the request
by comparing the received <code>X-Signature-256</code> value with the expected value.</p>
<p>Here&rsquo;s an example of a header value for a request with an empty body and <code>secret = mykey</code>:</p>
<pre><code>X-Signature-256: e1b24265bf2e0b20c81837993b4f1415f7b68c503114d100a40601eca6a2745f
</code></pre><p>Here is an example of how you can verify a webhook signature in your webhook receiver service:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8f5902;font-style:italic"># webhook_receiver.py</span>

<span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">hmac</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">hashlib</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">sha256</span>
<span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">flask</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Flask</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">request</span>

<span style="color:#000">app</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Flask</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">__name__</span><span style="color:#000;font-weight:bold">)</span>

<span style="color:#5c35cc;font-weight:bold">@app.route</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;/webhook&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">methods</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;POST&#34;</span><span style="color:#000;font-weight:bold">])</span>
<span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">webhook</span><span style="color:#000;font-weight:bold">():</span>
    <span style="color:#000">signature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">(</span>
        <span style="color:#4e9a06">&#34;sha256=&#34;</span>
        <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">hmac</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;mykey&#34;</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;utf-8&#34;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#000">request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">data</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">digestmod</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">sha256</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">hexdigest</span><span style="color:#000;font-weight:bold">()</span>
    <span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">hmac</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">compare_digest</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">request</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">headers</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;X-Signature-256&#34;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">signature</span><span style="color:#000;font-weight:bold">):</span>
        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">app</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">response_class</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">status</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">)</span>

    <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#000">app</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">response_class</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">status</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">500</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">response</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Signatures didn&#39;t match!&#34;</span><span style="color:#000;font-weight:bold">)</span>
</code></pre></div><h2 id="ping-webhook">Ping Webhook</h2>
<p>To confirm the proper configuration of your webhook and ensure that CVAT can establish
a connection with the target URL, use the <strong>Ping</strong> webhook feature.</p>
<p><img src="../../../../images/ping_webhook.jpg" alt="Ping Webhook "></p>
<ol>
<li>Click the <strong>Ping</strong> button in the user interface (or send a <code>POST /webhooks/{id}/ping</code> request through API).</li>
<li>CVAT will send a webhook alert to the specified target URL with basic information about the webhook.</li>
</ol>
<p>Ping webhook payload:</p>
<!--lint disable maximum-line-length-->
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>event</code></td>
<td><code>string</code></td>
<td>The value is always <code>ping</code>.</td>
</tr>
<tr>
<td><code>webhook</code></td>
<td><code>object</code></td>
<td>Complete information about the webhook. See the Swagger docs for a detailed description of fields.</td>
</tr>
<tr>
<td><code>sender</code></td>
<td><code>object</code></td>
<td>Information about the user who initiated the <code>ping</code> on the webhook.</td>
</tr>
</tbody>
</table>
<!--lint enable maximum-line-length-->
<p>Here is an example of a payload for the <code>ping</code> event:</p>
<div class="scroll-code">
  

  
    
  

  
  <div style="overflow-y: auto; max-height: 500px;"><div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">
<span style="color:#000;font-weight:bold">{</span>
   <span style="color:#204a87;font-weight:bold">&#34;event&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;ping&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;webhook&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/webhooks/7&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;target_url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;https://example.com&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;description&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;project&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;content_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;is_active&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;enable_ssl&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;created_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:23.007381Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;updated_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T08:05:23.007395Z&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;owner&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
        <span style="color:#000;font-weight:bold">},</span>
        <span style="color:#204a87;font-weight:bold">&#34;project&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">7</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;organization&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;events&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">[</span>
            <span style="color:#4e9a06">&#34;create:comment&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;create:issue&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;create:task&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;delete:comment&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;delete:issue&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;delete:task&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;update:comment&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;update:issue&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;update:job&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;update:project&#34;</span><span style="color:#000;font-weight:bold">,</span>
            <span style="color:#4e9a06">&#34;update:task&#34;</span>
        <span style="color:#a40000">\</span><span style="color:#000;font-weight:bold">],</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_status&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">200</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_delivery_date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;2022-10-04T11:04:52.538638Z&#34;</span>
    <span style="color:#000;font-weight:bold">},</span>
    <span style="color:#204a87;font-weight:bold">&#34;sender&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#204a87;font-weight:bold">&#34;url&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;&lt;http://localhost:8080/api/users/1&gt;&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;username&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;admin1&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;first_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Admin&#34;</span><span style="color:#000;font-weight:bold">,</span>
        <span style="color:#204a87;font-weight:bold">&#34;last_name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;First&#34;</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div></div>
</div>
<h2 id="webhooks-with-api-calls">Webhooks with API calls</h2>
<p>To create webhook via an API call,
see <a href="https://app.cvat.ai/api/docs">Swagger documentation</a>.</p>
<p>For examples,
see <a href="https://github.com/opencv/cvat/blob/develop/tests/python/rest_api/test_webhooks.py">REST API tests</a>.</p>
<h2 id="example-of-setup-and-use">Example of setup and use</h2>
<p>This video demonstrates setting up email alerts for a project using Zapier and Gmail.</p>
<!--lint disable maximum-line-length-->
<iframe width="560" height="315" src="https://www.youtube.com/embed/x87CsGsd-3I" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
<!--lint enable maximum-line-length-->

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-2 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Gitter public chat" aria-label="Gitter public chat">
    <a class="text-white" rel="noopener noreferrer" href="https://gitter.im/opencv-cvat/public">
      <i class="fab fa-gitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Stack Overflow" aria-label="Stack Overflow">
    <a class="text-white" rel="noopener noreferrer" href="https://stackoverflow.com/search?q=%23cvat">
      <i class="fab fa-stack-overflow"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="YouTube" aria-label="YouTube">
    <a class="text-white" rel="noopener noreferrer" href="https://www.youtube.com/@cvat-ai">
      <i class="fab fa-youtube"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-2 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" rel="noopener noreferrer" href="https://github.com/opencv/cvat">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Gitter developers chat" aria-label="Gitter developers chat">
    <a class="text-white" rel="noopener noreferrer" href="https://gitter.im/opencv-cvat/dev">
      <i class="fab fa-gitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Discord chat" aria-label="Discord chat">
    <a class="text-white" rel="noopener noreferrer" href="https://discord.gg/fNR3eXfk6C">
      <i class="fab fa-discord"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-8 text-center order-sm-2">
        <small class="mr-1"><a href="https://www.cvat.ai/privacy">Privacy Policy</a></small>
        |
        <small class="mx-1"><a href="https://www.cvat.ai/terms-of-use">Terms of Use</a></small>
      </div>
  
    <p class="mt-2"><a href="../../../../about/">About</a></p>
  
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>






 













<script src="../../../../js/main.min.3b172c13b62c2bea8b1c9d2599cddc8cf89718a92d792c680871c81ba43d8c85.js" integrity="sha256-OxcsE7YsK&#43;qLHJ0lmc3cjPiXGKkteSxoCHHIG6Q9jIU=" crossorigin="anonymous"></script>



<script src='../../../../js/prism.js'></script>



  </body>
</html>
